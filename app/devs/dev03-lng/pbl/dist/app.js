var App=function(t){"use strict";var e={};t.fn.swipe=function(e){var i,s,n,o=t.extend({preventDefault:!0,enableMouse:!0,distance:100,fastSwipe:!0,onTouch:function(t){},onMove:function(t){},onSwipe:function(t){console.log("onSwipe!!")},onEnd:function(){}},e||{});return this.each((function(){var e,a,r,_,h=t(this),l=!1,c={touchStart:function(t){if(!(t.targetTouches.length>1)){n=!1;var s=t.targetTouches[0];r=s.pageX,_=s.pageY,e=s.pageX,a=s.pageY,i=new Date,o.onTouch({clientX:s.clientX,clientY:s.clientY,pageX:s.pageX,pageY:s.pageY,screenX:s.screenX,screenY:s.screenY})}},mouseDown:function(t){n=!1,l=!0,r=t.pageX,_=t.pageY,e=t.pageX,a=t.pageY,i=new Date,o.onTouch({clientX:t.clientX,clientY:t.clientY,pageX:t.pageX,pageY:t.pageY,screenX:t.screenX,screenY:t.screenY}),o.preventDefault&&t.preventDefault()},mouseMove:function(t){l&&(o.onMove({deltaX:t.pageX-e,deltaY:t.pageY-a,clientX:t.clientX,clientY:t.clientY,pageX:t.pageX,pageY:t.pageY,screenX:t.screenX,screenY:t.screenY}),e=t.pageX,a=t.pageY),o.fastSwipe&&!n&&c.testSwipe(),o.preventDefault&&t.preventDefault()},moveEnd:function(t){l&&(l=!1,!n&&c.testSwipe()),o.preventDefault&&t.preventDefault(),o.onEnd()},touchEnd:function(t){l=!1,!n&&c.testSwipe(),o.onEnd()},touchMove:function(t){if(!(t.targetTouches.length>1)){var i=t.targetTouches[0];o.onMove({deltaX:i.pageX-e,deltaY:i.pageY-a,clientX:i.clientX,clientY:i.clientY,pageX:i.pageX,pageY:i.pageY,screenX:i.screenX,screenY:i.screenY,evt:t}),e=i.pageX,a=i.pageY,o.preventDefault&&t.preventDefault(),o.fastSwipe&&!n&&c.testSwipe()}},testSwipe:function(){var t=e-r,h=a-_;if(s=Math.abs(new Date-i)/1e3,Math.abs(t)>=Math.abs(h)){if(Math.abs(t)>=o.distance){n=!0;var l=t>=0?"right":"left";o.onSwipe({direction:l,distance:Math.abs(t),speed:Math.abs(t)/s,time:s})}}else if(Math.abs(h)>=o.distance){n=!0;l=h>=0?"down":"up";o.onSwipe({direction:l,distance:Math.abs(h),speed:Math.abs(h)/s,time:s})}},touchCancel:function(t){}};o.enableMouse&&(h.mousedown((function(t){1==((t=t||window.event).keyCode||t.which)&&c.mouseDown(t)})),h.mouseup(c.moveEnd),t("body").mouseup(c.moveEnd),h.mousemove(c.mouseMove)),this.addEventListener("touchstart",c.touchStart),this.addEventListener("touchmove",c.touchMove),this.addEventListener("touchend",c.touchEnd),this.addEventListener("touchcancel",c.touchCancel)}))},function(t){t.fn.longpress=function(e,i,s){return void 0===s&&(s=500),this.each((function(){var n,o,a=t(this);a.on("touchstart",(function(i){n=(new Date).getTime();var a=t(this);o=setTimeout((function(){"function"==typeof e?e.call(a,i):t.error("Callback required for long press. You provided: "+typeof e)}),s)})),a.on("touchend",(function(e){(new Date).getTime()-n<s&&(clearTimeout(o),"function"==typeof i?i.call(t(this),e):void 0===i||t.error("Optional callback for short press should be a function."))})),a.on("touchmove",(function(t){clearTimeout(o)}))}))}}(jQuery);var i={init:function(){this.$body=t("body"),this.MOBILE_STRING="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0",this.isAndroid=/(android)/i.test(navigator.userAgent),this.is_iOS=/iPad|iPhone|iPod/i.test(navigator.userAgent),this.initialHeight=window.outerHeight,this.metaViewport=document.querySelector("meta[name=viewport]"),this.behaviors()},behaviors:function(){var e=this;t(window).on("resize",(function(){e.isAndroid&&(e.TMR_RESIZE&&clearTimeout(e.TMR_RESIZE),e.TMR_RESIZE=setTimeout((function(){e.update_meta()}),150))}))},is_mobile:function(){return this.isAndroid||this.is_iOS},is_showed_any_menu:function(){return window[e.G_DATA].SHOWED>0},update_meta:function(){var t=this;this.is_showed_any_menu()&&(window.innerHeight<t.initialHeight/3*2?(t.$body.addClass("android_keyboard_open"),t.metaViewport.setAttribute("content","height="+t.initialHeight+", width=device-width, initial-scale=1.0")):(t.$body.removeClass("android_keyboard_open"),t.metaViewport.setAttribute("content",this.MOBILE_STRING)))},prepare:function(){var e=t("meta[name=viewport]");if(e.length)this.OLD_VIEWPORT=e[0].content.toString();else{this.OLD_VIEWPORT="";var i=document.createElement("meta");i.name="viewport",i.content="",document.getElementsByTagName("head")[0].appendChild(i),e=t("meta[name=viewport]")}},turn_on_mobile:function(e){var i=t("meta[name=viewport]");i[0].content=e?this.MOBILE_STRING:this.OLD_VIEWPORT}},s={get:function(){return"Rand_"+Math.random().toString(36).substring(2,15)+"_"+Math.random().toString(36).substring(2,15)}},n={bhv:function(e){if(e&&e.length){var i=function(t){return t.hasClass("mm2-disabled")};e.forEach((function(e){e.on("mouseover",(function(e){!i(t(this))&&t(this).addClass("hover")})),e.on("mouseout",(function(e){!i(t(this))&&t(this).removeClass("active hover")})),e.on("mousedown",(function(e){!i(t(this))&&t(this).addClass("active")})),e.on("mouseup",(function(e){!i(t(this))&&t(this).removeClass("active hover")})),e.on("touchstart",(function(e){!i(t(this))&&t(this).addClass("mobile-active")})),e.on("touchend",(function(e){!i(t(this))&&t(this).removeClass("mobile-active")}))}))}}},o={init:function(e){this.$allview=t(e),this.arrViews={},this.stackNames=[],this.viewsCount=0,this.CURRENT_VIEW_NAME="",this.CFG={speed:".6s",transition:".6s cubic-bezier(0.25, 1, 0.5, 1)"},this.$protectLayer=t("<div></div>").css({background:"rgba(0,0,0,0)",width:"100%",height:"100%",position:"absolute",top:0,left:0,zIndex:1e3,display:"none"}),this.$allview.append(this.$protectLayer)},addview:function(t){var e=t._get_view(),i=t._get_name();e.css({transform:"translate3d(100%,0,0)",opacity:0}),this.$allview.append(e),this.stackNames.push(i),this.arrViews[i]={view:t,level:this.viewsCount},this.viewsCount++},get:function(){return this.arrViews},bhv_protect:function(t){var e=this;this.$protectLayer.show(),setTimeout((function(){e.$protectLayer.hide()}),t)},get_name_by_level:function(t){return this.stackNames[t]},get_level_by_name:function(t){return this.arrViews[t].level},get_view_by_level:function(t){return this.get_view_by_name(this.get_name_by_level(t))},get_anim_by_viewname:function(t){return this.arrViews[t].view._get_anim()},get_view_by_name:function(t){return this.arrViews[t].view._get_view()},get_current_view:function(){return this.get_view_by_name(this.CURRENT_VIEW_NAME)},get_current_level:function(){return this.CURRENT_VIEW_NAME?this.get_level_by_name(this.CURRENT_VIEW_NAME):0},is_forward:function(t){return this.get_level_by_name(this.CURRENT_VIEW_NAME)<this.get_level_by_name(t)},move_forward:function(t,e,i){"animLeft"==i?(t&&t.css({transform:"translate3d(-50%,0,0)",transition:"transform "+this.CFG.transition}),e&&e.css({transform:"translate3d(0,0,0)",transition:"transform "+this.CFG.transition,opacity:1})):"zoomOut"==i&&(e.css({transform:"translate3d(0,0,0) scale(1.1)",transition:"0s",opacity:0}),setTimeout((()=>{e.css({transform:"translate3d(0,0,0) scale(1)",transition:".3s",opacity:1})}),50))},move_backward:function(t,e,i){var s=this;"animLeft"==i?(e&&e.css({transform:"translate3d(-50%,0,0)",transition:"all 0s",opacity:1}),setTimeout((()=>{e&&e.css({transform:"translate3d(0,0,0)",transition:"transform "+s.CFG.transition}),t&&t.css({transform:"translate3d(100%,0,0)",opacity:0,transition:"transform "+s.CFG.transition+", opacity 0s "+s.CFG.speed})}),50)):"zoomOut"==i&&(t&&t.css({transform:"translate3d(0,0,0) scale(1.1)",transition:".3s",opacity:0}),setTimeout((()=>{t&&t.css({transform:"translate3d(100%,0,0)",transition:"0s",zIndex:0})}),400))},park_view:function(t){t&&t.css({transform:"translate3d(100%,0,0)",opacity:0,transition:"transform 0s"})},set_current:function(t){if(!this.arrViews[t])return console.log("unknown the name"),!1;if(t==this.CURRENT_VIEW_NAME)return console.log(" the same name"),!1;if(console.log("current name",t),this.bhv_protect(700),this.CURRENT_VIEW_NAME){const e=this.get_current_view(),i=this.get_view_by_name(t),s=this.get_anim_by_viewname(t);this.is_forward(t)?this.move_forward(e,i,s):this.move_backward(e,i,s),this.CURRENT_VIEW_NAME=t}else{this.CURRENT_VIEW_NAME=t;this.get_current_view().css({transform:"translate3d(0,0,0)",opacity:1})}},go_back:function(){var t=this.get_current_level();if(t>0){this.bhv_protect(700);const e=this.get_current_view(),i=this.get_view_by_level(t-1),s=this.get_name_by_level(t),n=this.get_name_by_level(t-1),o=this.get_anim_by_viewname(s);this.move_backward(e,i,o),this.CURRENT_VIEW_NAME=n}},go_first:function(t){for(var e=this.get_current_level(),i=t?1:0,s=1;s<e+i;s++){var n=this.get_view_by_level(s);this.park_view(n)}var o=this.get_name_by_level(0);t?o!=this.CURRENT_VIEW_NAME&&(this.CURRENT_VIEW_NAME=o,this.get_current_view().css({transform:"translate3d(0,0,0)",transition:"transform 0s",opacity:1})):this.set_current(o)}},a={init:function(t){t=t||"en";this.CURRENT_LANG=t.toLowerCase(),this.ARR_LANGS=["en","ru","it"],this.LANG_CURRENT_INDEX=this.get_index(t),this.LANG_DATA={lng_amount:["Total amount:","Сумма:"],lng_address:["Address:","Адрес:"],lng_tel:["Ph.:","Тел.:"],lng_back:["Back","Назад"],lng_save:["Save","Сохранить"],lng_choose:["Choose","Выбрать"],lng_bookmarks:["Bookmarks","Закладки"],lng_close:["Close","Закрыть"],lng_day_after_tomorrow:["Day after tomorrow","Послезавтра"],lng_now:["Now","Сейчас"],lng_no_items:["no items","нет товаров"],lng_in_an_hour:["In an hour","Через час"],lng_in_two_hours:["In 2 hours","Через 2 часа"],lng_in_three_hours:["In 3 hours","Через 3 часа"],lng_order_comments:["Comments to the order:","Комментарии к заказу:"],lng_send:["Send","Отправить"],lng_more:["More...","Подробнее..."],lng_ordering:["Ordering","Оформление заказа"],lng_shopping_cart:["Your Cart","Корзина"],lng_sending_an_order:["Sending an order","Отправка заказа"],lng_rollup:["Roll-Up","Свернуть"],lng_today:["Today","Сегодня"],lng_tomorrow:["Tomorrow","Завтра"],lng_to_clear:["Clear","Очистить"],lng_to_bookmarks:["To bookmarks","В закладки"],lng_total:["Total:","Итого:"],lng_your_order:["Your order","Ваш заказ"],lng_you_ordered:["You ordered:","Вы заказали:"],lng_flag_spicy:["Spicy","Острое"],lng_flag_hit:["Hit","Хит"],lng_flag_vege:["Vege","Веге"],lng_our_adress:["Our address:","Наш адрес:"],lng_chef_cook:["Chef-cook:","Шеф-повар:"],lng_work_hours:["Work hours:","Часы работы:"],lng_slogan:["Create your own menu","Создай свое меню"],lng_cafe_desc_title:["Welcome!","Добро пожаловать!"],lng_cart_is_off:["The cart disabled <br>by admin","Корзина отключена <br>администратором"],lng_cart_is_empty:["The cart is empty","Корзина пуста"],lng_clear_shopping_cart:["Clear shopping cart","Очистить корзину"],lng_proceed_to_checkout:["Continue to<br>Checkout","Оформить<br>заказ"],lng_pick_up_the_order_myself:["I`ll pick it up<br> myself","Заберу сам"],lng_choosing_delivering:["Choose time and <br>place of delivery","Выбрать время<br>и место доставки"],lng_your_order:["Your order","Ваш заказ"],lng_thank_you:["Thank you","Спасибо"],lng_your_phone:["My phone:","Мой телефон:"],lng_need_user_phone:["Please provide your phone to clarify the details of the order","Внимание, укажите свой телефон для уточнения деталей заказа"],lng_where_to_deliver:["Where to deliver:","Куда доставить:"],lng_need_user_address:["Please specify the delivery address of the order","Внимание, укажите адрес доставки заказа"],lng_date_time_to:["When would you like your order:","Дата и время доставки:"],lng_pick_it_up_at:["I`ll pick up an order:","Заберу заказ:"],lng_your_shopping_cart_is_empty:["There are no products in your shopping cart","В вашей корзине нет товара"],lng_for_total_cost:["for total cost:","на общую сумму:"],lng_in_your_shopping_cart:["In your shopping cart:","В вашей корзине:"],lng_all_months:["January-February-March-April-May-June-July-August-September-October-November-December","Января-Февраля-Марта-Апреля-Мая-Июня-Июля-Августа-Сентября-Октября-Ноября-Декабря"],lng_number_of_your_order:["Your order number:","Номер вашего заказа:"],lng_time_from:["Order created:","Заявка создана:"],lng_time_to:["Order to:","Заказ на:"],lng_near_time:["soon","ближайшее время"],lng_order_sent:["Order sent","Заказ отправлен"],lng_thankful_msg:["The manager will contact you to confirm the order as soon as posible","В ближайшее время наш менеджер свяжется с вами для подтверждения заказа"],lng_thankful_waiter_msg:["Great! Our waiter is already in a hurry","Отлично! Официант уже спешит к вам"],lng_menu_is_in_demo_mode_msg:["The menu is in demo mode. The cafe administrator is not waiting a messages at the moment.","Меню находится в демонстрационном режиме. Администратор кафе не ожидает сообщений в данный момент."],lng_menu_is_in_demo_mode_msg_2:["If you are an Administrator, set up Telegram to receive orders.","Если вы Администратор, настройте Телеграм, чтобы получать заказы."],lng_something_wrong:["Something went wrong. Order can not be shipped now. <br>Try later","Что-то пошло не так. Заказ не может быть отправлен сейчас. <br>Попробуйте позже"],lng_wrong_phone:["Order can not be shipped. <br>Check the correctness of the phone you entered, please.","Заказ не может быть отправлен. <br>Проверьте правильность введенного вами телефона."]}},update:function(t){this.LANG_CURRENT_INDEX=this.get_index(t)},get_index(t){for(var e=0,i=this.ARR_LANGS,s=(t=t.toLowerCase(),0);s<i.length;s++)t===i[s]&&(e=s);return e},get_current:function(){return this.CURRENT_LANG},get_lang:function(){return this.ARR_LANGS[this.LANG_CURRENT_INDEX]},get:function(t){t=t.toLowerCase();return this.LANG_DATA[t]?this.LANG_DATA[t][this.LANG_CURRENT_INDEX]:"Unknown"}},r={init:function(){this.CN="mm2-",this._CN="."+this.CN,this.CLASS_CART_SWITCHED_OFF="mm2-cart-switched-off",this.$menu=t(this._CN+"menu"),this.$btnCartFooter=t(this._CN+"btn-basket__text"),this.cart_clear(),this.update_mode()},update_mode:function(){this.is_off()?this.$menu.addClass(this.CLASS_CART_SWITCHED_OFF):this.$menu.removeClass(this.CLASS_CART_SWITCHED_OFF)},add_preorder:function(t){let e=this.get_total_orders(t.itemId);const i=this.ALL_ORDERS[t.uniq_name];return i?i.count+=t.count:this.ALL_ORDERS[t.uniq_name]=t,this.update_btn_cart(),e+t.count},get:function(t){return this.ALL_ORDERS[t]},get_all:function(){return this.ALL_ORDERS},get_total_orders:function(t){let e=0;if(t){for(let i in this.ALL_ORDERS)if(this.ALL_ORDERS.hasOwnProperty(i)){let s=this.ALL_ORDERS[i];s&&s.itemId==t&&(e+=s.count)}}else for(let t in this.ALL_ORDERS)if(this.ALL_ORDERS.hasOwnProperty(t)){let i=this.ALL_ORDERS[t];i&&(e+=i.count)}return e},get_total_price:function(){let t=0;console.log("this.ALL_ORDERS for total price",this.ALL_ORDERS);for(let e in this.ALL_ORDERS)if(this.ALL_ORDERS.hasOwnProperty(e)){let i=this.ALL_ORDERS[e];i&&(t+=parseInt(i.price,10)*i.count)}return console.log("total_price ==== ",t),t},add_one:function(t){console.log("add_one",t);let e=this.ALL_ORDERS[t];e&&(e.count++,this.update_btn_cart())},remove_one:function(t){let e=this.ALL_ORDERS[t];e&&(e.count--,e.count||(console.log("delete!"),delete this.ALL_ORDERS[t]),this.update_btn_cart())},update_btn_cart:function(){this.get_total_orders()>0?this.$menu.addClass("cart-is-full"):this.$menu.removeClass("cart-is-full"),this.$btnCartFooter.html(this.the_total())},the_total:function(){return`${this.get_total_price()} ${e.CAFE.get("cafe_currency").symbol}`},cart_clear:function(t){this.ALL_ORDERS={},this.update_btn_cart()},is_off:function(){return 1!==parseInt(e.CAFE.get("cart_mode"),10)},is_empty:function(){var t=0,e=this.get_all();for(var i in e)e.hasOwnProperty(i)&&t++;return 0==t},the_items:function(){var t=this.get_total_orders(),i=e.LNG.get_lang();return t?{ru_parse:function(t){var e=parseInt(t.toString().substr(-1),10);return 1==e?t+" товар":e>1&&e<5?t+" товара":t+" товаров"},en_parse:function(t){return 1==parseInt(t.toString().substr(-1),10)?t+" item":t+" items"},it_parse:function(t){return 1==parseInt(t.toString().substr(-1),10)?t+" item":t+" items"}}[i+"_parse"](t):e.LNG.get("lng_no_items")}};const _={init:function(t){return this.item_data=t,this.SIZER=null,this._prepare(),this},get:function(){return this.item_data},has_modifiers:function(){return""!==this.item_data.iiko_modifiers},has_sizes:function(){this.item_data.iiko_sizes_parsed&&this.item_data.iiko_sizes_parsed.length},add_sizer:function(t){this.SIZER=t},add_modifiers:function(t){this.MODIFIERS=t},get_preorder:function(t){const e=this.get_price(),i=this.calc_order_uniq_name(`iiko-order-${this.item_data.id}`);return{itemId:this.item_data.id,uniq_name:i,price:e,count:t,volume:"",item_data:this.item_data,sizeName:"",sizeId:"",sizeCode:"",chosen_modifiers:""}},get_price:function(){const t=this.SIZER.get();return parseInt(t.price,10)+0},get_modifiers:function(){},get_sizes:function(){},_prepare:function(){""!==this.item_data.iiko_sizes&&(this.item_data.iiko_sizes_parsed=JSON.parse(this.item_data.iiko_sizes)),this.item_data.iiko_modifiers&&(this.item_data.iiko_modifiers_parsed=JSON.parse(this.item_data.iiko_modifiers))},calc_order_uniq_name:function(t){if(this.has_sizes()||this.has_modifiers()){return`${t}-${Math.floor(Date.now()*Math.random()/1e3).toString()}`}return t}};var h={init:function(t,e){return this.ITEM_DATA=t,this.onUpdate=e.onUpdate,this.CN="mm2-",this._CN="."+this.CN,this.reset(),this.build(),this},reset:function(){this.VARS={sizeName:"",sizeId:"",sizeCode:"",price:0,volume:0}},get_buttons:function(){return[this.$arr_btns.mobile,this.$arr_btns.desktop]},get:function(){return this.VARS},get_all:function(){return this.ITEM_DATA.iiko_sizes_parsed},set_current_vars:function(t){this.VARS=t},build:function(){var e=this;const i=this.get_all(),s=s=>{for(var n=0;n<i.length;n++){const o=i[n],a="true"==o.isDefault?" active":"",r=t("<div></div>",{class:this.CN+"item-size-btn "+a}),_=o.price||0,h=o.portionWeightGrams||0,l=o.sizeName||"",c=o.sizeId||"",d=o.sizeCode||"";r.html(l),function(t,i,s,n,o,a,r){t.on("touchend click",(function(_){e.change_current_size({$btn:t,index:i,price:s,volume:n,sizeName:o,sizeId:a,sizeCode:r}),_.originalEvent.cancelable&&_.preventDefault()}))}(r,n,_,h,l,c,d),"true"==o.isDefault&&this.set_current_vars({price:_,volume:h,sizeName:l,sizeId:c,sizeCode:d}),s.append(r)}};if(this.$arr_btns={mobile:t("<div></div>"),desktop:t("<div></div>")},i)if(i.length>1)s(this.$arr_btns.mobile),s(this.$arr_btns.desktop);else{var n=i[0];let t=n.price,e=n.portionWeightGrams;this.set_current_vars({price:t,volume:e,sizeName:"",sizeId:"",sizeCode:""})}else this.reset(),console.log("something wrong with iiko sizes",this.ITEM_DATA.id)},change_current_size:function(t){this.set_current_vars(t),this.onUpdate&&this.onUpdate(t),t.$btn.addClass("active").siblings().removeClass("active")}};const l={init:function(t){return this.item_data=t,this.MODIF_SCROLLED=!1,this.UI={list:null,btns:null},this._collect(),this._build(),this},get:function(t=null){return null!==t?this.ARR_MODIFIERS[t]:this.ARR_MODIFIERS},get_ui:function(){return this.UI},recalc:function(){let e=this,i=0,s=[];return this.get().length&&this.$MODIFIERS_BTNS&&this.$MODIFIERS_BTNS.each((function(n){if(t(this).hasClass("chosen")){const t=e.MODIFIERS.get(n),o=t.modifierId,a=t.price,r=t.name,_=t.modifierGroupId,h=t.modifierGroupName;s.push({id:o,name:r,price:a,modifierGroupId:_,modifierGroupName:h}),i+=parseInt(a,10)}})),[s,parseInt(i,10)]},_build:function(){const i=this;let s=this.get();if(s.length){const n=t("<ul></ul>");for(let t in s){let e=s[t].name,i=s[t].price;n.append(["<li>",'<div class="m-check"><span></span></div>','<div class="m-title">'+e+"</div>",'<div class="m-price">+'+i+" руб.</div>","</li>"].join(""))}const o=n.find("li");o.on("touchend click",(function(e,s){i.MODIF_SCROLLED||(t(this).toggleClass("chosen"),i.recalc()),e.originalEvent.cancelable&&e.preventDefault()})),e.MOBILE_BUTTONS.bhv([o]),this.UI={list:n,btns:o}}},_collect:function(){let t=this.item_data.iiko_modifiers_parsed;if(this.ARR_MODIFIERS=[],t&&t.length)for(let e in t){let i=t[e],s=i.items,n=i.modifierGroupId?i.modifierGroupId:"",o=i.name?i.name:"";if(console.log("modifierGroupId,modifierGroupName",n,o),s&&s.length)for(let t in s){let e=s[t];e.modifierGroupId=n,e.modifierGroupName=o,this.ARR_MODIFIERS.push(e)}}}};var c={init:function(i,s,n){return this.objParent=i,this.$elParent=i.get_element(),this.item_data=s,this.INDEX=n,this.CN="mm2-",this._CN="."+this.CN,this.CART_OFF=e.CART.is_off(),this.CLASS_DISABLED=this.CN+"disabled",this.$tpl=t("#mm2-templates "+this._CN+"item"),this.$item=this.$tpl.clone(),this.$item.css({transform:"translateX("+100*this.INDEX+"%)"}),""==this.item_data.image_url&&this.$item.addClass("has-no-image"),this.$btnAddToCart=this.$item.find(this._CN+"item-btn-addtocart"),this.$totalInCart=this.$item.find(this._CN+"item-btn-addtocart__count"),this.$itemData=this.$item.find(this._CN+"item-data"),this.$itemFlags=this.$item.find(this._CN+"item-flags2"),this.$itemImageContainer=this.$item.find(this._CN+"item-image"),this.$itemDataContainer=this.$item.find(this._CN+"item-data-container"),this.$descr=this.$item.find(this._CN+"item-description"),this.$bhvPortrait=this.$item.find(this._CN+"item-bhv-portrait"),this.$bhvLandscape=this.$item.find(this._CN+"item-bhv-landscape"),this.$btnReadMore=this.$item.find(this._CN+"item-btn-more-largescreen"),this.CLASS_PLAY_ADDTOCART=this.CN+"play-addtocart",this.CLASS_LARGE_IMAGE=this.CN+"show-large-image",this.CLASS_FULL_DESCRIPTION=this.CN+"show-full-description",this.CLASS_IMAGE_READY_TO_ZOOM=this.CN+"image-ready-to-zoom",this.CLASS_SHOWED_MODIFIERS="showed-modifiers",this.STARTSCROLL=0,this.DESCR_SCROLLED=!1,this.CART_OFF&&this.$btnAddToCart.addClass(this.CLASS_DISABLED),this.$item_price=this.$item.find(this._CN+"item-price span"),this.$item_volume=this.$item.find(this._CN+"item-volume"),this.$item_volume2=this.$item.find(this._CN+"item-volume2"),this.$iiko_btns_sizes_wrapper_mobile=this.$item.find(this._CN+"item-btns-sizes-mobile"),this.$iiko_btns_sizes_wrapper_desktop=this.$item.find(this._CN+"item-btns-sizes-desktop"),this.behavior(),this.$elParent.append(this.$item),"iiko"==this.item_data.created_by&&this.init_iiko_item(),this.insert_data(),this.update_lng(),this},get_view:function(){return this.$item},update_lng:function(){this.get_view().find("[lang]").each((function(i){t(this).html(e.LNG.get(t(this).attr("lang")))}))},get:function(){return this.item_data},get_element:function(){return this.$item},init_iiko_item:function(){this.IIKO_ITEM=t.extend({},_),this.IIKO_ITEM.init(this.item_data),this.IIKO_SIZER=t.extend({},h),this.IIKO_SIZER.init(this.item_data,{onUpdate:t=>{this.iiko_update_price_and_ui(t)}});const[e,i]=this.IIKO_SIZER.get_buttons();e&&e.size()&&(this.$item.addClass("item-sized"),this.$iiko_btns_sizes_wrapper_mobile.prepend(e),this.$iiko_btns_sizes_wrapper_desktop.prepend(i)),this.IIKO_ITEM.add_sizer(this.IIKO_SIZER),this.IIKO_MODIFIERS=t.extend({},l),this.IIKO_MODIFIERS.init(this.item_data),this.IIKO_ITEM.add_modifiers(this.IIKO_MODIFIERS)},add_item_to_cart:function(){const t=""!==e.CAFE.get().iiko_api_key;if(this.get(),this.objParent.get_menu_data(),e.CART)if(t&&this.IIKO_ITEM)if(this.IIKO_ITEM.has_modifiers())this.$item.addClass("showed-modifiers");else{const t=this.IIKO_ITEM.get_preorder(1);let i=e.CART.add_preorder(t);this.update_cart_btn(i),this.play_smile_animation()}else{const t=this.chefsmenu_get_preorder();let i=e.CART.add_order2(t);this.update_cart_btn(i),this.play_smile_animation()}},chefsmenu_get_preorder:function(){const t=this.item_data,e=`chefsmenu-pre-order-${t.id}`;return{itemId:t.id,uniq_name:e,price:t.price,count:1,volume:t.volume,item_data:t}},play_smile_animation:function(){this.$item.removeClass(this.CLASS_PLAY_ADDTOCART),setTimeout((()=>{this.$item.addClass(this.CLASS_PLAY_ADDTOCART)}),60)},insert_data:function(){const t=""!==e.CAFE.get().iiko_api_key;var i=this.item_data;this.$item.attr({id:i.id}),i.mode_spicy=parseInt(i.mode_spicy,10),i.mode_hit=parseInt(i.mode_hit,10),i.mode_vege=parseInt(i.mode_vege,10);var s=0;i.mode_spicy&&s++,i.mode_hit&&s++,i.mode_vege&&s++;var n="";switch(s){case 1:n="item-has-one-flag";break;case 2:n="item-has-two-flags";break;case 3:n="item-has-three-flags"}(i.mode_spicy||i.mode_hit||i.mode_vege)&&this.$item.addClass(this.CN+"item-has-flags"),n&&this.$item.addClass(this.CN+n),i.mode_spicy&&this.$item.addClass(this.CN+"item-has-flag-spicy"),i.mode_hit&&this.$item.addClass(this.CN+"item-has-flag-hit"),i.mode_vege&&this.$item.addClass(this.CN+"item-has-flag-vege");var o=e.CART.get_total_orders(i.id);this.update_cart_btn(o),this.$item.find(this._CN+"item-title").html(i.title),this.$item.find(this._CN+"item-about").html(i.description),t?this.iiko_update_price_and_ui(this.IIKO_SIZER.get()):(this.$item.find(this._CN+"item-price span").html(i.price+" "+e.CAFE.get("cafe_currency").symbol),this.$item.find(this._CN+"item-volume").html(i.volume)),this.update_item_data_container()},update_cart_btn:function(t){this.$totalInCart.html(t),t?this.$btnAddToCart.addClass("this-cart-full"):this.$btnAddToCart.removeClass("this-cart-full")},iiko_update_price_and_ui:function(t){var i=e.CAFE.get("cafe_currency").symbol;this.$item_price.html(t.price+" "+i),this.$item_volume.html(t.volume),this.$item_volume2.html(t.volume)},is_portrait:function(){return t(window).height()>t(window).width()-1},calc_data_size:function(){return{width:this.$itemImageContainer.width(),height:this.$itemImageContainer.height()}},calc_offset_vertical:function(){var t=this.calc_data_size();if(this.is_portrait()){var e=Math.round(t.height/100*35),i=this.has_class_large()?0:-e;return this.has_class_description()&&(i=-t.height),{left:0,top:i}}return{left:0,top:0}},calc_offset_size_btns:function(t){var e=this.calc_data_size();if(this.is_portrait()){var i=Math.round(e.height/100*61),s=Math.round(e.height/100*26),n=this.has_class_large()?-s:-i;return this.has_class_description()&&(n=-e.height-s),{posY:n}}return{posY:0}},update_item_data_container:function(){var t=this.calc_offset_vertical(),e=this.calc_offset_size_btns(t);this.$descr.scrollTop(0),this.$itemDataContainer.css({transform:"translate("+t.left+"px,"+t.top+"px)"}),this.$iiko_btns_sizes_wrapper_mobile.css({transform:"translate(0, "+e.posY+"px)"})},image_now_loading:function(){this.$item.addClass("mm2-image-loading")},image_end_loading:function(){this.$item.removeClass("mm2-image-loading")},calc_image_bounds:function(){if(!this.IMAGE&&!this.IMAGE.width)return!1;var t=this.IMAGE,e=0,i=0,s=this.calc_data_size();this.is_portrait()?e=this.calc_offset_vertical().top:i=this.has_class_large()?0:-Math.round(.4*s.width);var n=s.width+i,o=s.height+e,a=n/o>t.width/t.height?n/t.width:o/t.height,r=Math.round((t.width*a-n)/2)+i;return{top:-(Math.round((t.height*a-o)/2)+e),left:-r,scale:a}},has_class_large:function(){return this.$item.hasClass(this.CLASS_LARGE_IMAGE)},has_class_description:function(){return this.$item.hasClass(this.CLASS_FULL_DESCRIPTION)},insert_image:function(e){var i=this;this.IMAGE=e,this.image_end_loading();var s=this.calc_image_bounds();this.item_data.image_url,this.$image=t(e).css({position:"absolute",opacity:0,"transform-origin":"top left",transform:"translate("+s.left+"px,"+s.top+"px) scale("+s.scale+")"}),this.$itemImageContainer.html(this.$image),setTimeout((function(){i.$image.css({opacity:1,transition:"opacity 1s,transform .5s"}),i.$item.addClass(i.CLASS_IMAGE_READY_TO_ZOOM)}),100)},update_image:function(t){var e=t?"0s":".5s";if(this.IMAGE&&this.IMAGE.width){var i=this.calc_image_bounds();this.$image&&this.$image.css({transform:"translate("+i.left+"px,"+i.top+"px) scale("+i.scale+")",transition:e})}},update_layout:function(t){this.update_item_data_container(t),this.update_image(t)},on_resize:function(){var t=this;this.TMR_RESIZE&&clearTimeout(this.TMR_RESIZE),this.TMR_RESIZE=setTimeout((function(){t.update_item_data_container(),t.update_image()}),200)},behavior:function(){var i=this;e.MOBILE_BUTTONS.bhv([this.$btnAddToCart]);var s=function(t){if(!i.is_portrait())return!1;"up"==t.direction?(console.log("==up"),i.bhv_portrait_touched(!0)):"down"!=t.direction||i.has_class_large()?"left"==t.direction?i.objParent.try_next():"right"==t.direction&&i.objParent.try_prev():(console.log("==down"),i.bhv_portrait_touched())},n=function(t){if(!i.is_portrait())return!1;"up"==t.direction||"down"==t.direction||("left"==t.direction?i.objParent.try_next():"right"==t.direction&&i.objParent.try_prev())};this.$bhvPortrait.swipe({onSwipe:function(t){s(t)},distance:40,enableMouse:!1}),this.$bhvPortrait.on("click",(function(e){var s=e.originalEvent,n=i.calc_offset_vertical(),o=t(this).height()-s.offsetY<Math.abs(n.top);i.bhv_portrait_touched(o)})),this.$descr.on("touchstart",(function(t){i.is_portrait()&&(i.DESCR_SCROLLED=!1)})),this.$descr.on("touchmove",(function(t){i.is_portrait()&&(i.DESCR_SCROLLED=!0)})),this.$descr.swipe({onSwipe:function(t){n(t)},distance:40,enableMouse:!1,preventDefault:!1}),this.$descr.on("touchend",(function(t){!i.DESCR_SCROLLED&&i.is_portrait()&&i.portrait_close_descr(),t.originalEvent.cancelable&&t.preventDefault(),t.stopPropagation()})),this.$descr.on("mousedown",(function(){i.is_portrait()&&(i.DESCR_SCROLLED=!1)})),this.$descr.on("mousemove",(function(){i.is_portrait()&&(i.DESCR_SCROLLED=!0)})),this.$descr.on("click",(function(){return i.is_portrait()&&!i.DESCR_SCROLLED&&i.portrait_close_descr(),!1})),this.$btnReadMore.on("touchend click",(function(){return console.log("btnReadMore clicked"),i.is_portrait()&&i.has_class_description()&&i.portrait_close_descr(),!1})),t(window).on("resize",(function(){i.on_resize(),i.update_item_data_container()})),this.$bhvLandscape.on("click",(function(t){return i.bhv_landscape_touched(),!1})),this.$btnAddToCart.on("touchend click",(function(){return!i.CART_OFF&&i.add_item_to_cart(),!1}))},bhv_landscape_touched:function(){this.has_class_large()?this.$item.removeClass(this.CLASS_LARGE_IMAGE):this.$item.addClass(this.CLASS_LARGE_IMAGE),this.update_image()},bhv_portrait_touched:function(t){this.has_class_description()?this.portrait_close_descr():this.has_class_large()?this.objParent.all_items_close_large_images():t?this.portrait_show_descr():this.objParent.all_items_show_large_images()},portrait_close_large_image:function(t){this.$item.removeClass(this.CLASS_LARGE_IMAGE),this.update_layout(t)},portrait_show_large_image:function(t){this.$item.addClass(this.CLASS_LARGE_IMAGE),this.update_layout(t)},portrait_close_descr:function(){this.$item.removeClass(this.CLASS_FULL_DESCRIPTION),this.update_layout()},portrait_show_descr:function(){this.$item.addClass(this.CLASS_FULL_DESCRIPTION),this.update_layout()},close_modifiers_panel:function(){this.$item.removeClass(this.CLASS_SHOWED_MODIFIERS),this.$item.addClass("xxx")}},d={init:function(e){if(!e.G_DATA||!e.$link||!e.CHEFS_URL)return!1;this.G_DATA=e.G_DATA,this.$link=e.$link,this.CHEFS_URL=e.CHEFS_URL,this.$body=t("body"),this.CLASS_MENU_IS_SHOWED="chefsmenu-is-showed",this.CLASS_READY_TO_USE="ready-to-use",this.CLASS_IIKO_MODE="menu-iiko-mode",this.CLASS_CHEFSMENU_MODE="menu-chefsmenu-mode",this.CLASS_SHOW_PRELOAD="chefsmenu-show-preload",this.CLASS_CAFE_IS_IN_ARCHIVE="chefsmenu-cafe-is-in-archive",this.UNIQ_CAFE=this.$link.attr("data-cafe"),this.NO_CLOSE=this.$link.attr("noclose"),this.AUTOLOAD=this.$link.attr("autoload"),this.onMenuReady=e.onReady,this.load_style_asynq().then((t=>{this.pre_build_asynq().then((t=>{this.$link.on("click",(()=>(window[this.G_DATA].SAVED_BODY_POS=window.pageYOffset,this.show({cafe:this.UNIQ_CAFE}),!1))),this.AUTOLOAD&&setTimeout((()=>{this.show({cafe:this.UNIQ_CAFE})}),200),this.init_views()})).catch((t=>{console.log("err",t)}))})).catch((t=>{console.log("err",t)}))},init_views:function(){var t=this,i="#mm2-templates";e.LNG.init("ru"),e.MENU_ICONS.init(),e.UVIEWS.init(".mm2-all-views"),e.UVIEWS.addview(e.VIEW_ALLMENU.init({name:"the-allmenu",template:i+" .view-allmenu",chefsmenu:t,noclose:this.NO_CLOSE,anim:"animLeft"})),e.UVIEWS.addview(e.VIEW_ALLITEMS.init({name:"the-allitems",template:i+" .view-items",chefsmenu:t,noclose:this.NO_CLOSE,anim:"animLeft"})),e.UVIEWS.addview(e.VIEW_IIKO_MODIFIERS.init({name:"the-iiko-modifiers",template:i+" .view-iiko-modifiers",chefsmenu:t,noclose:this.NO_CLOSE,anim:"zoomOut"})),e.UVIEWS.addview(e.VIEW_TABLE_CHANGE.init({name:"view-table-change",template:i+" .view-table-change",chefsmenu:t,noclose:this.NO_CLOSE,anim:"animLeft"})),e.UVIEWS.addview(e.VIEW_CART.init({name:"the-showcart",template:i+" .view-showcart",chefsmenu:t,noclose:this.NO_CLOSE,anim:"animLeft"})),e.UVIEWS.addview(e.VIEW_CHOOSING_MODE.init({name:"the-choosing-mode",template:i+" .view-choosing-mode",chefsmenu:t,noclose:this.NO_CLOSE,anim:"animLeft"})),e.UVIEWS.addview(e.VIEW_ORDERING.init({name:"the-ordering",template:i+" .view-ordering",chefsmenu:t,noclose:this.NO_CLOSE,anim:"animLeft"})),e.UVIEWS.addview(e.VIEW_ORDER_OK.init({name:"the-order-ok",template:i+" .view-order-ok",chefsmenu:t,noclose:this.NO_CLOSE,anim:"animLeft"})),e.UVIEWS.addview(e.VIEW_ORDER_CANCEL.init({name:"the-order-cancel",template:i+" .view-order-cancel",chefsmenu:t,noclose:this.NO_CLOSE,anim:"animLeft"})),e.UVIEWS.addview(e.VIEW_THANK_YOU.init({name:"the-thank-you",template:i+" .view-thank-you",chefsmenu:t,noclose:this.NO_CLOSE,anim:"animLeft"})),e.TABINDEX.init(),this.onMenuReady&&this.onMenuReady()},set_allitems:function(t,e){return window[this.G_DATA].ALLITEMS[t.id]=e},get_allitems:function(t){return window[this.G_DATA].ALLITEMS[t.id]},get_cafe:function(){return window[this.G_DATA].ALLCAFE[this.get_uniq_name()]},get_allmenu:function(){return window[this.G_DATA].ALLMENU[this.get_uniq_name()]},get_uniq_name:function(){return this.CAFE_UNIQ_NAME},get_url_to_images:function(){return window[this.G_DATA].URL_TO_IMAGES},show:function(t){var i=this;window[i.G_DATA].SHOWED++,this.CAFE_UNIQ_NAME=t.cafe,i.$body.addClass(i.CLASS_MENU_IS_SHOWED),i.$body.addClass(i.CLASS_SHOW_PRELOAD),i.$menu.show(),setTimeout((function(){i.now_loading()}),50);var s=function(t){var e=window[i.G_DATA],s="light-lemon";t=t||s;if(!e.CURRSKIN.label||e.CURRSKIN.label!==t){e.CURRSKIN.link&&i.detach_style(e.CURRSKIN.link);var n=e.ALLSKINS[t]||e.ALLSKINS[s],o=e.MAINSTYLE;for(var a in n)n.hasOwnProperty(a)&&(r=new RegExp("%\\["+a+"\\]%","gi"),o=o.replace(r,n[a]));a="skin-label";var r=new RegExp("%\\["+a+"\\]%","gi");o=o.replace(r,t),e.CURRSKIN.label=t,e.CURRSKIN.link=i.append_style(o)}};this.load_all_menu({onReady:function(){var t=i.get_cafe(),n=t.skin_label;console.log("---cafe.lang---",t.lang),s(n);const o=e.UVIEWS.get();if(t.lang.toLowerCase()!==e.LNG.get_current()){e.LNG.update(t.lang);for(let t in o)if(o.hasOwnProperty(t)){o[t].view._update_lng()}}i.show_win({skin:t.skin,onReady:function(){e.CAFE.init(t),e.VIEW_ALLMENU.update(i.get_allmenu()),e.CART.init(),e.UVIEWS.go_first("fast");const s=""!==e.CAFE.get().iiko_api_key?i.CLASS_IIKO_MODE:i.CLASS_CHEFSMENU_MODE;i.$menu.addClass(s),setTimeout((function(){i.$body.removeClass(i.CLASS_SHOW_PRELOAD),i.$menu.addClass(i.CLASS_READY_TO_USE)}),50),setTimeout((function(){i.end_loading()}),300)}})}})},show_win:function(t){t&&t.onReady&&t.onReady()},now_loading:function(){this.LOADING=!0,this.$menu&&this.$menu.addClass("now-loading")},end_loading:function(){this.LOADING=!1,this.$menu&&this.$menu.removeClass("now-loading")},is_loading_now:function(){return this.LOADING},pre_build_asynq:function(){return new Promise(((i,s)=>{const n=this,o={loadApp:function(a){n.AJAX=t.ajax({url:a+"?callback=?",jsonpCallback:e.CALLBACK_RANDOM.get(),dataType:"jsonp",method:"POST",success:function(e){window[n.G_DATA].WAS_BUILT||o.appendToBody(e[0].app),n.$menu=t("."+window[n.G_DATA].PRE+"menu"),i(e)},error:function(t){s(t)}})},appendToBody:function(e){t("body").append(e),window[n.G_DATA].WAS_BUILT=!0}};window[n.G_DATA].WAS_BUILT?(n.$menu=t("."+window[n.G_DATA].PRE+"menu"),i("ok")):o.loadApp(GLB_APP_URL+"pbl/views/pbl.php")}))},detach_style:function(t){t.remove()},append_style:function(t){var e=document.createElement("style");return e.type="text/css",e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t)),document.getElementsByTagName("head")[0].appendChild(e)},load_style_asynq:function(){return new Promise(((i,s)=>{const n=this,o=GLB_APP_URL+"pbl/css/style.php",a=function(t){let e={},s=t.skins["all-skins"];for(let t=0;t<s.length;t++)e[s[t].label]=s[t].params;window[n.G_DATA].ALLSKINS=e,window[n.G_DATA].MAINSTYLE=t["main-style"],n.append_style(t["head-style"]),i()};null!==window[n.G_DATA].ALLSKINS?i("ok"):this.AJAX=t.ajax({url:o+"?callback=?",jsonpCallback:e.CALLBACK_RANDOM.get(),dataType:"jsonp",data:{},method:"POST",success:function(t){a(t)},error:function(t){s(t)}})}))},load_all_menu:function(i){var s=this,n=GLB_APP_URL+"pbl/lib/pbl.get_all_menu.php",o=this.get_uniq_name(),a=window[s.G_DATA].ALLMENU[o],r=function(t){for(var e={},i=0;i<t.length;i++)e[t[i].id]=t[i];return e.arr=t,e},_={cafe:o};console.log("data",_),a?i.onReady&&i.onReady():this.AJAX=t.ajax({url:n+"?callback=?",jsonpCallback:e.CALLBACK_RANDOM.get(),dataType:"jsonp",method:"POST",data:_,success:function(t){if(t.error)console.log("error",t.error),s.close_menu_win(),s.goto404();else if(1==t.cafe.cafe_status)s.close_menu_win(),s.gotoArchive();else{var e=r(t.menu);window[s.G_DATA].ALLMENU[o]=e,window[s.G_DATA].ALLCAFE[o]=t.cafe,setTimeout((function(){i.onReady&&i.onReady()}),500)}},error:function(t){console.log("err response",t),s.goto404()}})},goto404:function(){location.href=this.CHEFS_URL.server+"cafe/"},gotoArchive:function(){this.$body.addClass(this.CLASS_CAFE_IS_IN_ARCHIVE)},close_menu_win:function(){var t=this;setTimeout((function(){window[t.G_DATA].SHOWED--,t.$body.removeClass(t.CLASS_MENU_IS_SHOWED),t.$body.removeClass(t.CLASS_SHOW_PRELOAD),t.$menu&&t.$menu.removeClass(t.CLASS_READY_TO_USE),t.$menu&&t.$menu.hide();var e=window[t.G_DATA].SAVED_BODY_POS;e&&window.scroll(0,e),window[t.G_DATA].SAVED_BODY_POS=0}),300)}},u={init:function(){return this.$allinputs=t("input,textarea"),this.clear(),this},clear:function(){this.$allinputs.attr("tabindex","-1")}},m={init:function(e){this.parent=e,this._CN=e._CN,this.$table_mode_protect=t("body").find(this._CN+"protect-table-mode"),this.$table_mode_protect__message=this.$table_mode_protect.find(this._CN+"protect-table-mode__message"),this.$table_mode_protect__btn_ok=this.$table_mode_protect.find(this._CN+"protect-table-mode__button-ok"),this.ORDER_TO_TABLE_MODE=t("body").hasClass("mode-orderto-table"),this.TABLE_NUMBER=-1,this.btnTableNumber=this.parent.$view.find(this._CN+"header__table-number"),this.btnTableNumber_number=this.parent.$view.find(this._CN+"header__table-number_number"),this.parent._update_lng()},update:function(){let t=`${CHEFS_URL.server}cafe/${e.CAFE.get().uniq_name}/`;if(this.ORDER_TO_TABLE_MODE)if(this.check_table_number()){this.btnTableNumber_number.html(this.TABLE_NUMBER);let e=`<p>Вы открыли меню для столика №&nbsp;${this.TABLE_NUMBER}, предназначенное для работы внутри заведения</p>\n                        <p>Для перехода Меню в обычный режим, с&nbsp;возможностью сделать заказ на доставку или самовывоз, нажмите ОК</p>`;this.$table_mode_protect__message.html(e),this.$table_mode_protect__btn_ok.on("click",(()=>{location.href=t})),this.behavior()}else{let e="<p>В адресе Меню для заказа в стол возможно ошибка!</p>\n                        <p>Меню перейдет в обычный режим, с&nbsp;возможностью сделать заказ на доставку или самовывоз.</p>";this.parent._show_modal_win(e,{onClose:()=>{location.href=t}})}},check_table_number:function(){let i=t("body").data("table-uniq"),s=e.CAFE.get().tables_uniq_names,n=!1;if(i&&s){s=JSON.parse(s);for(let t in s)if(s.hasOwnProperty(t)&&i===s[t]){n=!0;let t=i.split("-");this.TABLE_NUMBER=t[0]}}return n},get_table_number:function(){return this.TABLE_NUMBER},is_table_mode:function(){return this.ORDER_TO_TABLE_MODE},behavior:function(){this.btnTableNumber.on("touchend",(t=>{e.VIEW_TABLE_CHANGE.update(this.TABLE_NUMBER),e.UVIEWS.set_current("view-table-change")}))}},f={_init:function(e){this.name=e.name,this.level=e.level,this.$view=t(e.template).clone(),this.chefsmenu=e.chefsmenu,this.noclose=e.noclose,this.animName=e.anim,this.CN="mm2-",this._CN="."+this.CN,this.$tpl=t("#mm2-templates"),this.$tplItem=t("#mm2-templates "+this._CN+"cart-item"),this.$content=this.$view.find(".std-content"),this.$modal=t("body").find(this._CN+"modal-win"),this.$modalTitle=this.$modal.find(this._CN+"modal-win__title"),this.$modalMessage=this.$modal.find(this._CN+"modal-win__message"),this.$modalBtnOk=this.$modal.find(this._CN+"modal-win__button-ok"),this.NEED_TO_SAVE=!1,this.VIEW_SCROLLED=!1,this._update_lng()},_behavior:function(i){var s=this;e.MOBILE_BUTTONS.bhv(i),this.noclose&&this.$btnClose.hide(),t(window).on("touchstart",(function(){s.VIEW_SCROLLED=!1})).on("touchmove",(function(){s.VIEW_SCROLLED=!0})),this.$btnClose.on("touchend click",(function(){return s._close_menu(),!1}))},_show_modal_win:function(t,e){this.$modal.removeClass("visible"),this.$modal.show(),this.$modalMessage.html(t),this.$modalBtnOk.on("click",(t=>{this.$modal.removeClass("visible"),setTimeout((()=>{this.$modal.hide()}),600),e&&e.onClose&&e.onClose(),t.originalEvent.cancelable&&t.preventDefault()})),setTimeout((()=>{this.$modal.addClass("visible")}),100)},_content_hide:function(){this.$view.addClass(this.CN+"content-hidden")},_content_show:function(){this.$view.removeClass(this.CN+"content-hidden")},_update_tabindex:function(){e.TABINDEX.clear(),this.$view.find("input, textarea").each((function(e){t(this).attr("tabindex",e)}))},_update_lng:function(i){return(i=i||this._get_view()).find("[lang]").each((function(i){t(this).html(e.LNG.get(t(this).attr("lang")))})),i},_get_name:function(){return this.name},_get_view:function(){return this.$view},_get_anim:function(){return this.animName},_close_menu:function(){this.noclose?e.UVIEWS.go_first():this.chefsmenu.close_menu_win()},_need2save:function(t){this.NEED_TO_SAVE=t,t?this.$view&&this.$view.addClass("need-to-save"):this.$view&&this.$view.removeClass("need-to-save")}},p={init:function(t){return this._init(t),this.$headerTitle=this.$view.find(this._CN+"allmenu-header-title"),this.$headerPhone=this.$view.find(this._CN+"header-phone"),this.$btnBasket=this.$view.find(this._CN+"btn-basket"),this.$btnClose=this.$view.find(this._CN+"btn-close-menu"),this.$btnBack=this.$view.find(this._CN+"btn-back, "+this._CN+"std-header-btn-back, "+this._CN+"btn-close-items"),this.$menuListContainer=this.$view.find(this._CN+"allmenu-list2"),this.$tplMenuItem=this.$tpl.find(this._CN+"allmenu-row"),this.$cafeDescription=this.$view.find(this._CN+"cafe-description"),this.$btnSlideUpAbout=this.$view.find(this._CN+"btn-slideup"),this.$btnsLangContainer=this.$view.find(this._CN+"langs__buttons"),this.CLASS_SHOWED_ABOUT=this.CN+"allmenu-about-showed",this.LIST_SCROLLED=!1,e.MENU_TABLE_MODE.init(this),this.behavior(),this},update:function(i){var s=this;e.MENU_TABLE_MODE.update(),console.log("allmenu",i),this.build_langs_ui(),this.all_menu=i;var n=function(){var i=t("<ul></ul>");i.on("touchstart",(function(){s.LIST_SCROLLED=!1})),i.on("touchmove",(function(){s.LIST_SCROLLED=!0}));for(var n=0;n<s.all_menu.arr.length;n++){var o=s.all_menu.arr[n];!function(t){var n=s.$tplMenuItem.clone();n.find(s._CN+"allmenu-row__title span").html(o.title).end(),n.find(s._CN+"allmenu-row__icon").addClass(s.CN+"icon-"+e.MENU_ICONS.get(o.id_icon)),n.find("a").attr({"data-id-menu":t}).on("touchend click",(function(i){if(!s.LIST_SCROLLED){var n=s.get_menu_by_id(t);e.VIEW_ALLITEMS.update(n),s.chefsmenu.now_loading(),e.UVIEWS.set_current("the-allitems")}i.originalEvent.cancelable&&i.preventDefault(),i.stopPropagation()})),i.append(n)}(o.id)}i.find("li").each((function(e){t(this).css({transition:".3s "+.1*e+"s transform"})})),s.$menuListContainer.html(i),setTimeout((function(){s.$menuListContainer.addClass(s.CN+"allmenu-list-showed")}),10)};const o=e.CAFE.get("cafe_title");this.$headerTitle.find(this._CN+"allmenu-header-title__text").html(o);var a=e.CAFE.get("cafe_phone");if(""!==a?this.$headerPhone.find(this._CN+"header-phone__text").html(a):this.$headerPhone.hide(),a){var r=a.replace(/[-() ]/g,"");this.$headerPhone.on("touchend click",(function(){return location.href="tel:"+r,!1}))}var _=this.$cafeDescription,h=e.CAFE.get("cafe_address"),l=this.CN+"cafe-description__br",c=e.CAFE.get("cafe_description").replace(/\n/g,"<div class='"+l+"'></div>"),d=e.CAFE.get("chief_cook"),u=""!==e.CAFE.get("work_hours")?e.CAFE.get("work_hours"):"Не указаны";(_=this._update_lng(_)).find(this._CN+"cafe-description-address").html(e.LNG.get("lng_our_adress")+" <strong>"+h+"</strong>"),_.find(this._CN+"cafe-description-chief").html(e.LNG.get("lng_chef_cook")+" <strong>"+d+"</strong>"),_.find(this._CN+"cafe-description-workhours").html(e.LNG.get("lng_work_hours")+" <strong>"+u+"</strong>"),_.find(this._CN+"cafe-description-about").html(c),""===d&&_.find(this._CN+"cafe-description-chief").hide(),this.$menuListContainer.html(""),n()},get_menu_by_id:function(t){return this.all_menu[t]},build_langs_ui:function(){const i=this;this.$view.removeClass("multilang-mode");const s=e.CAFE.get(),n=!!s.extra_langs&&JSON.parse(s.extra_langs);if(!n)return;this.$view.addClass("multilang-mode"),console.log("this.$btnsLangContainer",this.$btnsLangContainer.html()),this.$btnsLangContainer.html("");const o=[],a=[];for(let t in n)a.push(t);a.unshift("ru");for(let e in a){let i=a[e],s=t(`<div data-user-lang="${i}" ${"ru"===i?'class="current"':""}><span>${i}</span></div>`);this.$btnsLangContainer.append(s),o.push(s)}this.$btnsLangContainer.find("div").on("touchend click",(function(e){const s=t(this).data("user-lang");i.set_user_language(s),e.cancelable&&e.preventDefault()})),this._behavior(o)},set_user_language:function(t){console.log("lng",t)},behavior:function(){var t=this,i=[this.$btnBasket,this.$btnBack,this.$btnClose,this.$headerTitle,this.$btnSlideUpAbout];this._behavior(i),this.$headerTitle.on("touchend click",(function(e){t.$view.toggleClass(t.CLASS_SHOWED_ABOUT),e.originalEvent.cancelable&&e.preventDefault()})),this.$btnSlideUpAbout.on("touchend click",(function(e){t.$view.removeClass(t.CLASS_SHOWED_ABOUT),e.originalEvent.cancelable&&e.preventDefault()})),this.$btnBasket.on("touchend click",(function(t){e.VIEW_CART.update(),e.UVIEWS.set_current("the-showcart"),t.originalEvent.cancelable&&t.preventDefault()}))}},g={init:function(t){return this._init(t),this.$headerIcon=this.$view.find(this._CN+"std-header-icon"),this.$headerTitle=this.$view.find(this._CN+"std-header-title"),this.$btnBasket=this.$view.find(this._CN+"btn-basket"),this.$btnClose=this.$view.find(this._CN+"btn-close-menu"),this.$btnBack=this.$view.find(this._CN+"btn-back, "+this._CN+"std-header-btn-back, "+this._CN+"btn-close-items"),this.$btnNextItem=this.$view.find(this._CN+"item-btn-next"),this.$btnPrevItem=this.$view.find(this._CN+"item-btn-prev"),this.$page_counter=this.$view.find(this._CN+"footer-item-pagecounter span"),this.$itemsContainer=this.$view.find(this._CN+"allitems-container"),this.$bhv=this.$view.find(this._CN+"bhv"),this.TOTAL_ITEMS=0,this.ALL_ITEMS=[],this.ITEMS={},this.CURRENT=0,this.behavior(),this},update:function(t){var i=this;for(var s in this.MENU=t,this.$headerTitle.find("span").html(t.title),e.MENU_ICONS.get())this.$headerIcon.removeClass(i.CN+"icon-"+e.MENU_ICONS.get(s));this.$headerIcon.addClass(i.CN+"icon-"+e.MENU_ICONS.get(this.MENU.id_icon)),this._content_hide();var n=this.chefsmenu.get_allitems(this.MENU),o=function(){console.log("ok!"),i._content_show(),setTimeout((function(){i.chefsmenu.end_loading(),setTimeout((function(){i.start_load_images()}),300)}),100)};n?(this.ALL_ITEMS=n,this.TOTAL_ITEMS=this.ALL_ITEMS.arr.length,setTimeout((function(){i.build({onReady:function(){o()}})}),600)):setTimeout((function(){i.load_items({onReady:function(){console.log("start build"),i.build({onReady:function(){o()}})}})}),400)},get_menu_data:function(){return this.MENU},get_total:function(){return this.TOTAL_ITEMS},get_items:function(t){return void 0!==t?this.ALL_ITEMS[t]:this.ALL_ITEMS},hide_bhv_btns:function(t){t?this.$bhv.hide():this.$bhv.show()},behavior:function(){var t=[this.$btnBasket,this.$btnBack,this.$btnClose,this.$btnNextItem,this.$btnPrevItem];this._behavior(t),this.$btnBasket.on("touchend click",(t=>{e.VIEW_CART.update(),e.UVIEWS.set_current("the-showcart"),t.originalEvent.cancelable&&t.preventDefault()})),this.$btnBack.on("touchend click",(t=>{e.UVIEWS.go_back(),t.originalEvent.cancelable&&t.preventDefault()})),this.$btnNextItem.on("touchend click",(t=>{this.try_next(),t.originalEvent.cancelable&&t.preventDefault()})),this.$btnPrevItem.on("touchend click",(t=>{this.try_prev(),t.originalEvent.cancelable&&t.preventDefault()}))},update_btns:function(){0==this.CURRENT?(this.$view.removeClass("items-last-page"),this.$view.addClass("items-first-page")):this.CURRENT==this.TOTAL_ITEMS-1?(this.$view.addClass("items-last-page"),this.$view.removeClass("items-first-page")):(this.$view.removeClass("items-last-page"),this.$view.removeClass("items-first-page"))},start_load_images:function(){var t=this;this.NOW_IMG_LOADING=!1,this.ARR_NEED_TO_LOAD_IMAGE=[];var e=this.get_items();if(this.get_total())for(var i=0;i<e.arr.length;i++)e.arr[i].image_url&&this.ARR_NEED_TO_LOAD_IMAGE.push(e.arr[i]),e.arr[i].image_url&&this.ITEMS[e.arr[i].id].image_now_loading();var s={next_load_image:function(){var e=t.ARR_NEED_TO_LOAD_IMAGE.shift();e?s.load_image(e,(function(i){setTimeout((function(){t.ITEMS[e.id].insert_image(i),s.next_load_image()}),300)})):(console.log("end load"),t.NOW_IMG_LOADING=!1)},load_image:function(e,i){t.NOW_IMG_LOADING=new Image,t.NOW_IMG_LOADING.onload=function(){i&&i(this)},t.NOW_IMG_LOADING.src=e.image_url}};s.next_load_image()},load_items:function(i){var s=this,n=GLB_APP_URL+"pbl/lib/pbl.get_all_items.php",o=function(t){for(var e={},i=0;i<t.length;i++)e[t[i].id]=t[i];return e.arr=t,e},a={menu:this.MENU.id};this.AJAX=t.ajax({url:n+"?callback=?",jsonpCallback:e.CALLBACK_RANDOM.get(),dataType:"jsonp",method:"POST",data:a,success:function(e){console.log("allitems",e),t(e).each((function(){this.price=this.price||0})),s.TOTAL_ITEMS=e.length,s.ALL_ITEMS=o(e),s.chefsmenu.set_allitems(s.MENU,s.ALL_ITEMS),i&&i.onReady&&i.onReady()},error:function(t){console.log("err response",t)}})},build:function(i){this.$itemsContainer.html(""),this.ITEMS={};var s=this.get_items();if(console.log("- - - -items- - - -",s),this.get_total())for(var n=0;n<s.arr.length;n++){var o=t.extend({},e.ITEM);this.ITEMS[s.arr[n].id]=o.init(this,s.arr[n],n)}this.CURRENT=0,this.go_to(this.CURRENT,"fast"),this.update_page_counter(),i&&i.onReady&&i.onReady()},get_element:function(){return this.$itemsContainer},all_items_show_large_images:function(){var t=this.ALL_ITEMS.arr;if(!t.length)return!1;for(var e=0;e<t.length;e++){var i=e!==this.CURRENT,s=this.ALL_ITEMS.arr[e].id,n=this.ITEMS[s];n&&n.portrait_show_large_image(i)}},all_items_close_large_images:function(){var t=this.ALL_ITEMS.arr;if(!t.length)return!1;for(var e=0;e<t.length;e++){var i=e!==this.CURRENT,s=this.ALL_ITEMS.arr[e].id,n=this.ITEMS[s];n&&n.portrait_close_large_image(i)}},current_item_close_modifiers:function(){var t=this.ALL_ITEMS.arr[this.CURRENT].id,e=this.ITEMS[t];e&&e.close_modifiers_panel()},current_item_close_description:function(){var t=this.ALL_ITEMS.arr[this.CURRENT].id,e=this.ITEMS[t];e&&e.portrait_close_descr()},try_next:function(){if(!this.get_total())return!1;this.current_item_close_description(),this.current_item_close_modifiers(),this.CURRENT<this.get_total()-1?(this.CURRENT+=1,this.go_to(this.CURRENT)):this.show_cant_next()},try_prev:function(){if(!this.get_total())return!1;this.current_item_close_description(),this.current_item_close_modifiers(),this.CURRENT>0?(this.CURRENT-=1,this.go_to(this.CURRENT)):this.show_cant_prev()},go_to:function(t,e){var i=e?"0s":"0.5s";this.$itemsContainer.css({transform:"translateX(-"+100*t+"%)",transition:i}),this.update_page_counter(),this.update_btns()},pages_move:function(t,e){this.$itemsContainer.css({transform:"translateX("+t+")",transition:"transform "+e})},show_cant_prev:function(){var t=this;this.pages_move("3%","0.1s"),setTimeout((function(){t.pages_move("0%","0.5s")}),100)},show_cant_next:function(){var t=this,e=100*(this.get_total()-1);this.pages_move(-(e+3)+"%","0.1s"),setTimeout((function(){t.pages_move(-e+"%","0.5s")}),100)},update_page_counter:function(){this.$page_counter.html(this.CURRENT+1+"/"+this.get_total())}},C={send_async:function(t,e){return new Promise(((i,s)=>{this._get_token_async().then((n=>{this._send_with_token_async(t,e,n).then((t=>{i(t)})).catch((t=>{s(t)}))})).catch((t=>{s(t)}))}))},send_to_table_async:function(t,e){return new Promise(((i,s)=>{this._get_token_async().then((n=>{this._send_with_token_to_table_async(t,e,n).then((t=>{i(t)})).catch((t=>{s(t)}))})).catch((t=>{s(t)}))}))},_send_with_token_async:function(e,i,s){return new Promise(((n,o)=>{const a=GLB_APP_URL+"pbl/lib/iiko/iiko_send_order_for_delivery.php",r={id_cafe:e.id_cafe,token:s,order:e,pickupself:i};console.log("data",r);t.ajax({url:a+"?callback=?",data:r,dataType:"jsonp",method:"POST",error:t=>{o(t)}}).then((t=>{t&&!t.error?n(t):o(t)}))}))},_send_with_token_to_table_async:function(i,s,n){return new Promise(((o,a)=>{const r=GLB_APP_URL+"pbl/lib/iiko/iiko_send_order_to_table.php",_=e.CAFE.get().id,h=e.CART.get_total_price(),l=(c=new Date).getDate()+"-"+(c.getMonth()+1)+"-"+c.getFullYear()+" "+c.getHours()+":"+c.getMinutes();var c;const d={id_cafe:_,token:n,orders:i,table_number:s,total_price:h,order_time_sent:l};console.log("data",d);t.ajax({url:r+"?callback=?",data:d,dataType:"jsonp",method:"POST",error:t=>{a(t)}}).then((t=>{t&&!t.error?o(t):a(t)}))}))},_get_token_async:function(){return new Promise(((i,s)=>{const n=GLB_APP_URL+"pbl/lib/iiko/get_token_for_cafe_pbl.php";let o=this._get_token_localy();if(o)return void i(o);const a={id_cafe:e.CAFE.get().id};t.ajax({url:n+"?callback=?",data:a,dataType:"jsonp",method:"POST",error:t=>{s(t)}}).then((t=>{t&&t.token?(o=t.token,this._save_token_localy(o),i(o)):s(t)}))}))},_get_token_localy:function(){var t=e._IIKO_TOKEN,i=e._IIKO_TOKEN_DATE;if(t&&i){var s=((new Date).getTime()-i)/36e5;return console.log("duration",s),!s||s>.5?(console.log("token too old, and will be get new"),!1):t}return console.log("unknown token, will be get new"),!1},_save_token_localy:function(t){e._IIKO_TOKEN=t,e._IIKO_TOKEN_DATE=(new Date).getTime()}},v={init:function(t){return this._init(t),this.CLASS_EMPTY=this.CN+"cart-isempty",this.READY_TO_ORDERING=!1,this.$totalValue=this.$view.find(this._CN+"cart-total .value"),this.$btnBasket=this.$view.find(this._CN+"btn-basket"),this.$btnClose=this.$view.find(this._CN+"btn-close-menu"),this.$btnBack=this.$view.find(this._CN+"btn-back, "+this._CN+"std-header-btn-back, "+this._CN+"btn-close-items"),this.$btnClearCart=this.$view.find(this._CN+"btn-clear, "+this._CN+"header-btn-clear"),this.$btnOrdering=this.$view.find(this._CN+"btn-ordering"),this.$itemsContainer=this.$view.find(this._CN+"cart-allitems"),this.clear_cart_container(),this.behavior(),this},behavior:function(){var t=[this.$btnBasket,this.$btnBack,this.$btnClose,this.$btnClearCart,this.$btnOrdering];this._behavior(t),this.$btnClearCart.on("touchend click",(t=>{this.clear_cart(),t.originalEvent.cancelable&&t.preventDefault()})),this.$btnBack.on("touchend click",(t=>{e.UVIEWS.go_first(),t.originalEvent.cancelable&&t.preventDefault()})),this.$btnOrdering.on("touchend click",(t=>{const i=""!==e.CAFE.iiko_api_key;this.READY_TO_ORDERING&&!this.chefsmenu.is_loading_now()&&(i&&e.MENU_TABLE_MODE.is_table_mode()?(this.chefsmenu.now_loading(),this.iiko_send_order_to_table()):this.send_order()),t.originalEvent.cancelable&&t.preventDefault()}))},iiko_send_order_to_table:function(){let i=e.CART.get_all();const s=e.MENU_TABLE_MODE.get_table_number();this.IIKO_TBL_SENDER=t.extend({},C),this.IIKO_TBL_SENDER.send_to_table_async(i,s).then((t=>{const n=t.short_number,o=t.demo_mode;t.notg_mode;const a={short_number:n,demo_mode:o,order_items:i};this.chefsmenu.end_loading(),e.VIEW_ORDER_OK.update(a,{table_number:s}),e.UVIEWS.set_current("the-order-ok")})).catch((t=>{this._show_modal_win("Заказ не получается отправить. \n            \tОбратитесь к администратору кафе."),console.log("err",t),setTimeout((()=>{this.chefsmenu.end_loading()}),300)}))},send_order:function(){const t=e.CAFE.get().has_delivery>0;console.log("send_order, HAS_DELIVERY=",t),t?(e.VIEW_CHOOSING_MODE.update(),e.UVIEWS.set_current("the-choosing-mode")):(e.VIEW_ORDERING.update({pickupMode:!0}),e.UVIEWS.set_current("the-ordering"))},clear_cart:function(){e.CART.cart_clear(),e.VIEW_ORDERING.update({clear:!0}),this.update("clear")},clear_cart_container:function(){this.$itemsContainer.html(""),e.CART.get_total_orders()?this.$content.removeClass(this.CLASS_EMPTY):this.$content.addClass(this.CLASS_EMPTY)},update:function(t){var i=this;const s=e.CART.get_all(),n=""!==e.CAFE.get().iiko_api_key;let o=e.CART.get_total_price();o>0?this.$btnOrdering.removeClass(i.CN+"btn-disabled"):this.$btnOrdering.addClass(i.CN+"btn-disabled"),o>0?this.$btnClearCart.removeClass(i.CN+"btn-disabled"):this.$btnClearCart.addClass(i.CN+"btn-disabled"),this.READY_TO_ORDERING=o>0;const a={buildAll:()=>{this.ALL_ROWS={};for(let t in s)if(s.hasOwnProperty(t)){let e=s[t];e&&a.buildRow(e)}},buildRow:t=>{let s=t.item_data.title,n=t.count,o=t.price,a=t.uniq_name,r=t.chosen_modifiers,_=t.volume;t.sizeName&&(_=t.sizeName+" / "+_);let h="";if(r.length)for(let t in r){h+="+ "+r[t].name+"<br>"}let l=this.$tplItem.clone();l.find(this._CN+"cart-title__item").html(s),l.find(this._CN+"cart-title__volume").html(_),l.find(this._CN+"cart-title__modifiers").html(h),l.find(this._CN+"cart-quantity").html(n+" x "+o+" "+e.CAFE.get("cafe_currency").symbol),function(t){let s=l.find(i._CN+"cart-more").on("touchend click",(()=>(i.add_to_cart(t),!1))),n=l.find(i._CN+"cart-less").on("touchend click",(()=>(i.remove_from_cart(t),!1)));s&&n&&e.MOBILE_BUTTONS.bhv([s,n])}(a),this.$itemsContainer.append(l),this.ALL_ROWS[a]=l}};var r={buildAll:function(){for(var t in i.ALL_ROWS={},s)s.hasOwnProperty(t)&&r.buildRow(s[t]);setTimeout((function(){var t=0;for(var e in i.ALL_ROWS)if(i.ALL_ROWS.hasOwnProperty(e)){var s=.2*t+.5+"s";i.ALL_ROWS[e].css({opacity:1,transform:"translateX(0)",transition:s}),t++}}),300)},buildRow:function(t){const s=t.item_data.title,n=t.count,o=t.price,a=t.uniq_name;t.volume;const r=i.$tplItem.clone().css({opacity:0,transform:"translateX(50px)"});r.find(i._CN+"cart-title").html(s),r.find(i._CN+"cart-quantity").html(n+" x "+o+" "+e.CAFE.get("cafe_currency").symbol);const _=r.find(i._CN+"cart-more").on("touchend click",(function(){return i.add_to_cart(a),!1})),h=r.find(i._CN+"cart-less").on("touchend click",(function(){return i.remove_from_cart(a),!1}));_&&h&&e.MOBILE_BUTTONS.bhv([_,h]),i.$itemsContainer.append(r),i.ALL_ROWS[a]=r},updateRow:function(t){const n=s[t];if(n){const s=n.count+" x "+n.price+" "+e.CAFE.get_currency().symbol;i.ALL_ROWS[t].find(i._CN+"cart-quantity").html(s)}else e.CART.is_empty()?i.update("clear"):(i.ALL_ROWS[t].css({opacity:0,transform:"translateX(-50px)",transition:"0.3s"}),setTimeout((function(){i.ALL_ROWS[t].remove()}),300))}};if(t)if("clear"!==t)r.updateRow(t);else{let t=0;for(let e in this.ALL_ROWS)if(this.ALL_ROWS.hasOwnProperty(e)){let i=.2*t+.5+"s";this.ALL_ROWS[e]&&this.ALL_ROWS[e].css({opacity:0,transform:"translateX(-50px)",transition:i}),t++}setTimeout((()=>{this.clear_cart_container()}),500)}else this.clear_cart_container(),n?a.buildAll():r.buildAll();this.$totalValue.html(e.CART.the_total())},add_to_cart:function(t){e.CART.add_one(t),this.update(t)},remove_from_cart:function(t){e.CART.remove_one(t),this.update(t)}},b={init:function(t){return this._init(t),this.$btnBasket=this.$view.find(this._CN+"btn-basket"),this.$btnClose=this.$view.find(this._CN+"btn-close-menu"),this.$btnBack=this.$view.find(this._CN+"btn-back, "+this._CN+"std-header-btn-back, "+this._CN+"btn-close-items"),this.$btnInPickUp=this.$view.find(this._CN+"btn-choosing-pick-up"),this.$btnDelivering=this.$view.find(this._CN+"btn-choosing-delivering"),this.behavior(),this},update:function(){this._update_tabindex()},behavior:function(){var t=[this.$btnInPickUp,this.$btnBack,this.$btnDelivering];this._behavior(t),this.$btnBack.on("touchend click",(t=>{e.UVIEWS.go_back(),t.originalEvent.cancelable&&t.preventDefault()})),this.$btnInPickUp.on("touchend click",(t=>{e.VIEW_ORDERING.update({pickupMode:!0}),e.UVIEWS.set_current("the-ordering"),t.originalEvent.cancelable&&t.preventDefault()})),this.$btnDelivering.on("touchend click",(t=>{this.chefsmenu.is_loading_now()||(this.chefsmenu.now_loading(),e.VIEW_ORDERING.update(),e.UVIEWS.set_current("the-ordering")),t.originalEvent.cancelable&&t.preventDefault()}))}},E={init:function(t){return this._init(t),this.$btnBasket=this.$view.find(this._CN+"btn-basket"),this.$btnClose=this.$view.find(this._CN+"btn-close-menu"),this.$btnBack=this.$view.find(this._CN+"btn-back, "+this._CN+"std-header-btn-back, "+this._CN+"btn-close-items"),this.$msgAmount=this.$view.find(this._CN+"thank-you-amount"),this.$msgCartList=this.$view.find(this._CN+"thank-you-cart-list"),this.behavior(),this},behavior:function(){var t=[this.$btnBasket,this.$btnBack,this.$btnClose];this._behavior(t),this.$btnBack.on("touchend click",(function(){return e.UVIEWS.go_first(),!1}))},update:function(t){var i=e.CAFE.get("cafe_currency").symbol,s="",n=e.CART.get_all();if(e.CART.is_empty())s="В корзине еще ничего нет";else{var o=0;for(var a in n){var r=n[a].count,_=n[a].item;s+="<li><div>"+(o+1)+". "+_.title+"</div><div>"+r+"х"+_.price+"  "+i+"</div></li>",o++}s="<li>"+s+"</li>"}this.$msgCartList.html(s);var h="Итого: <span>"+e.CART.the_total()+"</span>";this.$msgAmount.html(h)}},$={load_async_for:function(t){return new Promise(((e,i)=>{this._get_token_async().then((s=>{this._load_with_token_async(t,s).then((t=>{e(t)})).catch((t=>{i(t)}))})).catch((t=>{i(t)}))}))},_load_with_token_async:function(e,i){return new Promise(((s,n)=>{const o=GLB_APP_URL+"pbl/lib/iiko/iiko_get_streets_for_delivery.php",a={id_cafe:e,token:i};t.ajax({url:o+"?callback=?",data:a,dataType:"jsonp",method:"POST",error:t=>{n(t)}}).then((t=>{t&&!t.error?s(t):n(t)}))}))},_get_token_async:function(){return new Promise(((i,s)=>{const n=GLB_APP_URL+"pbl/lib/iiko/get_token_for_cafe_pbl.php";let o=this._get_token_localy();if(o)return void i(o);const a={id_cafe:e.CAFE.get().id};console.log("data----,url",a,n);t.ajax({url:n+"?callback=?",data:a,dataType:"jsonp",method:"POST",error:t=>{s(t)}}).then((t=>{t&&t.token?(o=t.token,this._save_token_localy(o),i(o)):s(t)}))}))},_get_token_localy:function(){var t=e._IIKO_TOKEN,i=e._IIKO_TOKEN_DATE;if(t&&i){var s=((new Date).getTime()-i)/36e5;return console.log("duration",s),!s||s>.5?(console.log("token too old, and will be get new"),!1):t}return console.log("unknown token, will be get new"),!1},_save_token_localy:function(t){e._IIKO_TOKEN=t,e._IIKO_TOKEN_DATE=(new Date).getTime()}},A={init:function(t){return this._init(t),this.TIME_FORMAT=24,this.CLASS_24FORMAT=this.CN+"timeformat-24",this.CLASS_DISABLED=this.CN+"ordering-disabled",this.CLASS_USERTIME_MODE=this.CN+"ordering-usertime-mode",this.CLASS_CURRENT=this.CN+"ordering-select-current",this.CLASS_INPUT_ERROR=this.CN+"input-error",this.$btnBasket=this.$view.find(this._CN+"btn-basket"),this.$btnClose=this.$view.find(this._CN+"btn-close-menu"),this.$btnBack=this.$view.find(this._CN+"btn-back, "+this._CN+"std-header-btn-back, "+this._CN+"btn-close-items"),this.$btnSend=this.$view.find(this._CN+"btn-send"),this.$inputs=this.$view.find("input, textarea"),this.errMessage1=this.$view.find(this._CN+"ordering-message-1"),this.errMessage2=this.$view.find(this._CN+"ordering-message-2"),this.$allParams=this.$view.find(this._CN+"ordering-params"),this.$userComments=this.$view.find(this._CN+"ordering-comment"),this.$btnDate=this.$view.find(this._CN+"ordering-select-date"),this.$btnDateSelect=this.$view.find(this._CN+"ordering-select-date select"),this.$btnTime=this.$view.find(this._CN+"ordering-select-time"),this.$btnTimeSelect=this.$view.find(this._CN+"ordering-select-time select"),this.$btnUsertime=this.$view.find(this._CN+"ordering-select-usertime"),this.$btnUsertimeSelect=this.$view.find(this._CN+"ordering-select-usertime select"),this.$btnTimeSwitch=this.$view.find(this._CN+"ordering-select-switch"),this.$cart_result_message=this.$view.find(this._CN+"cart-result"),this.$fields=this.$view.find(this._CN+"ordering-field, "+this._CN+"ordering-select-usertime"),this.$section_user_address=this.$view.find(this._CN+"ordering-params__user_address"),this.$section_date_time_to=this.$view.find(this._CN+"date-time-to"),this.$section_pick_it_up_at=this.$view.find(this._CN+"pick-it-up-at").hide(),this.PICKUPSELF_MODE=!1,this.STREETS_LIST=[],this.build_times_select(),this.behavior(),this},update:function(t){if(console.log("VIEW ORDERING!",t),this._update_tabindex(),this._show_attention(!1,!1),this.IIKO_MODE=""!==e.CAFE.get().iiko_api_key,t&&t.pickupMode?(this.PICKUPSELF_MODE=!0,this.$section_user_address.hide(),this.$section_date_time_to.hide(),this.$section_pick_it_up_at.show()):(this.PICKUPSELF_MODE=!1,this.$section_user_address.show(),this.$section_date_time_to.show(),this.$section_pick_it_up_at.hide()),t&&t.clear){this.$allParams.find("[name=u_phone]").val(""),this.$allParams.find("[name=u_address]").val(""),this.$userComments.val("");var i="<p>"+e.LNG.get("lng_your_shopping_cart_is_empty")+"</p>";this.chefsmenu.end_loading()}else{i=["<p>"+e.LNG.get("lng_for_total_cost")+"<br><span>"+e.CART.the_total()+"</span></p>"].join("\n");const t=""!==e.CAFE.get().iiko_api_key;this.STREETS_LIST.length||this.PICKUPSELF_MODE||!t?this.chefsmenu.end_loading():(console.log("start loading streets"),this.load_iiko_cities_async().then((t=>{this.STREETS_LIST=t,this.$view.find(this._CN+"streets"),console.log("streets",t);const e=new autoComplete({selector:"input[name=u_street]",placeHolder:"...",data:{src:t,cache:!0},resultItem:{highlight:!0},events:{input:{selection:t=>{console.log("!!",t);const i=t.detail.selection.value;setTimeout((()=>{e.input.value=i}),500)}}}});setTimeout((()=>{this.chefsmenu.end_loading()}),300)})).catch((t=>{this._show_modal_win("Невозможно загрузить список улиц. \n\t\t            \tОбратитесь к администратору кафе."),console.log("err",t),setTimeout((()=>{this.chefsmenu.end_loading()}),300)})))}this.$cart_result_message.html(i)},build_times_select:function(){24==this.TIME_FORMAT&&this.$allParams.addClass(this.CLASS_24FORMAT);this.$btnUsertimeSelect.html(function(t){for(var e="",i=24==t,s=1;s<t+1;s++){var n=i?s-1:s;e+="<option>"+n+":00</option>",e+="<option>"+n+":30</option>"}return e}(this.TIME_FORMAT))},get_usertime_mode:function(){return this.$allParams.hasClass(this.CLASS_USERTIME_MODE)},set_usertime_mode:function(t){t?this.$allParams.addClass(this.CLASS_USERTIME_MODE):this.$allParams.removeClass(this.CLASS_USERTIME_MODE)},set_date_default:function(){this.$btnDateSelect[0].selectedIndex=0},set_time_default:function(){this.$btnTimeSelect[0].selectedIndex=0},set_usertime_default:function(){var t=24==this.TIME_FORMAT?24:0;this.$btnUsertimeSelect[0].selectedIndex=t},behavior:function(){var i=this,s=[this.$btnBasket,this.$btnBack,this.$btnClose,this.$btnSend];this._behavior(s),this.$fields.each((function(){var e=t(this);e.find("input, textarea, select").on("click",(function(){i.$fields.removeClass("focused"),e.addClass("focused")}))}));var n=()=>{const t=e.CAFE.get().has_delivery>0;console.log("has_delivery",t,e.CAFE.get().has_delivery),t?e.UVIEWS.go_back():e.UVIEWS.set_current("the-showcart")};this.$btnBack.on("touchend click",(t=>{this.$inputs.is(":focus")?(this.$inputs.blur(),setTimeout((()=>{n()}),500)):n(),this.$fields.removeClass("focused"),t.originalEvent.cancelable&&t.preventDefault()})),this.$btnSend.on("touchend click",(t=>{this.chefsmenu.is_loading_now()||(this.chefsmenu.now_loading(),this.$inputs.is(":focus")?(this.$inputs.blur(),setTimeout((()=>{this.checkup_user_inputs()}),500)):this.checkup_user_inputs(),this.$fields.removeClass("focused")),t.originalEvent.cancelable&&t.preventDefault()})),this.$btnTimeSwitch.on("touchend click",(t=>{this.get_usertime_mode()?(this.set_date_default(),this.set_usertime_default(),this.set_usertime_mode(!1)):(this.set_time_default(),this.set_usertime_default(),this.set_usertime_mode(!0)),t.originalEvent.cancelable&&t.preventDefault()})),this.$btnDateSelect.on("change",(t=>{console.log("this.$btnDateSelect.val()",this.$btnDateSelect.val()),this.$btnDateSelect.val()>0?this.get_usertime_mode()||(this.set_usertime_default(),this.set_usertime_mode(!0)):(this.set_time_default(),this.set_usertime_default(),this.set_usertime_mode(!1)),t.originalEvent.cancelable&&t.preventDefault()}))},_show_attention:function(t,e){t?this.errMessage1.addClass(this.CLASS_INPUT_ERROR):this.errMessage1.removeClass(this.CLASS_INPUT_ERROR),e?this.errMessage2.addClass(this.CLASS_INPUT_ERROR):this.errMessage2.removeClass(this.CLASS_INPUT_ERROR)},checkup_user_inputs:function(){var t=this;this._show_attention(!1,!1);var i=this.$allParams.find("[name=u_phone]").val();let s="";s=this.PICKUPSELF_MODE?"Заберу заказ сам.":this.$allParams.find("[name=u_address]").val();let n={u_street:this.$allParams.find("[name=u_street]").val(),u_house:this.$allParams.find("[name=u_house]").val(),u_flat:this.$allParams.find("[name=u_flat]").val(),u_entrance:this.$allParams.find("[name=u_entrance]").val(),u_floor:this.$allParams.find("[name=u_floor]").val()};if(this.IIKO_MODE){if(this.PICKUPSELF_MODE){if(!i)return this._show_attention(!i,!1),this.flash_inputs_errors(),void setTimeout((()=>{this.chefsmenu.end_loading()}),500)}else if(!i||!n.u_street||!n.u_house)return this._show_attention(!i,!n.u_street||!n.u_house),this.flash_inputs_errors(),void setTimeout((()=>{this.chefsmenu.end_loading()}),500)}else if(this.PICKUPSELF_MODE){if(!i)return this._show_attention(!i,!1),this.flash_inputs_errors(),void setTimeout((()=>{this.chefsmenu.end_loading()}),500)}else if(!i||!s)return this._show_attention(!i,!s),this.flash_inputs_errors(),void setTimeout((()=>{this.chefsmenu.end_loading()}),500);var o={getTimeto:function(){return t.get_usertime_mode()?{usertimemode:!0,timeSelected:t.$btnUsertimeSelect.find("option:selected").text()}:{usertimemode:!1,hourOffset:parseInt(t.$btnTimeSelect.val(),10)}},getDateAndTimeto:function(e){var i=new Date,s=parseInt(t.$btnDateSelect.val(),10);if(s)n=o.parseSelectedTime(e),a=new Date(i.getFullYear(),i.getMonth(),i.getDate()+s,n.hours,n.minutes);else if(e.usertimemode)var n=o.parseSelectedTime(e),a=new Date(i.getFullYear(),i.getMonth(),i.getDate(),n.hours,n.minutes);else var a=new Date(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours()+e.hourOffset,i.getMinutes());return a},parseSelectedTime:function(t){var e=t.timeSelected.split(":"),i={hours:parseInt(e[0],10),minutes:parseInt(e[1],10),pm:t.pm};return o.to24(i)},to24:function(t){var e={hours:0,minutes:t.minutes};return t.pm?(e.hours=t.hours<12?t.hours+12:t.hours,e):(e.hours=t.hours<12?t.hours:0,e)},dateExport:function(t){return t.getDate()+"-"+(t.getMonth()+1)+"-"+t.getFullYear()+" "+t.getHours()+":"+t.getMinutes()}},a=o.getDateAndTimeto(o.getTimeto());const r={id_cafe:e.CAFE.get("id"),order_currency:e.CAFE.get("cafe_currency"),order_total_price:e.CART.get_total_price(),order_user_phone:i,order_user_address:s,order_user_iiko_address:n,order_time_need:o.dateExport(a),order_time_sent:o.dateExport(new Date),order_user_comment:this.$userComments.val()};this.IIKO_MODE?this.iiko_order_send(r):this.chefsmenu_order_send(r)},flash_inputs_errors:function(){this.$allParams.animate({scrollTop:0},300),this.errMessage1.addClass("flashed"),this.errMessage2.addClass("flashed"),setTimeout((()=>{this.errMessage1.removeClass("flashed"),this.errMessage2.removeClass("flashed")}),300)},is_phone_number:function(t){var e=t.match(/\d/g);return!(!e||11!=e.length)},iiko_order_send:function(i){const s=e.CART.get_all(),n=t.extend(i,{order_items:s});e.CAFE.get_status(),this.IIKO_SENDER=t.extend({},C),this.IIKO_SENDER.send_async(n,this.PICKUPSELF_MODE).then((t=>{console.log("--vars--",t),n.short_number=t.short_number,n.demo_mode=t.demo_mode,n.notg_mode=!!t.notg_mode;const i=this.PICKUPSELF_MODE;e.VIEW_ORDER_OK.update(n,{pickupself_mode:i}),e.UVIEWS.set_current("the-order-ok")})).catch((t=>{this._show_modal_win("Заказ не получается отправить. \n            \tОбратитесь к администратору кафе."),console.log("err",t),setTimeout((()=>{this.chefsmenu.end_loading()}),1e3)}))},chefsmenu_order_send:function(i){var s=this,n=GLB_APP_URL+"pbl/lib/pbl.ordering.php",o=e.LNG.get("lng_something_wrong");e.LNG.get("lng_wrong_phone");var a=e.CART.get_all(),r=[];for(var _ in a)if(a.hasOwnProperty(_)){let t=a[_];r.push({title:t.item_data.title,price:t.item_data.price,id_item:t.item_data.id,id_menu:t.item_data.id_menu,count:t.count})}const h=t.extend(i,{order_items:r});h.pickupself_mode=this.PICKUPSELF_MODE;var l={send:function(i,n){t.ajax({url:i+"?callback=?",jsonpCallback:e.CALLBACK_RANDOM.get(),dataType:"jsonp",method:"POST",data:{order_data:n},success:function(t){console.log("--response1--",t),t.error?l.showCancelReport(o):l.showOrderCheck(t)},error:function(t){console.log("--response2--",t),s.chefsmenu.end_loading(),l.showCancelReport(o)}})},showCancelReport:function(t){e.VIEW_ORDER_CANCEL.update(t),e.UVIEWS.set_current("the-order-cancel")},showOrderCheck:function(t){h.short_number=t.short_number,h.demo_mode=t.demo_mode,h.notg_mode=t.notg_mode;const i=s.PICKUPSELF_MODE;e.VIEW_ORDER_OK.update(h,{pickupself_mode:i}),e.UVIEWS.set_current("the-order-ok")}};this.chefsmenu.now_loading(),l.send(n,h)},load_iiko_cities_async:function(){return new Promise(((i,s)=>{t.extend({},$).load_async_for(e.CAFE.get().id).then((t=>{t.streets?i(t.streets):s(t)})).catch((t=>{s(t)}))}))}},S={init:function(e){return this._init(e),this.$headerPhone=this.$view.find(this._CN+"header-phone"),this.$btnBasket=this.$view.find(this._CN+"btn-basket"),this.$btnClose=this.$view.find(this._CN+"btn-close-menu"),this.$btnBack=this.$view.find(this._CN+"btn-back, "+this._CN+"std-header-btn-back, "+this._CN+"btn-close-items"),this.$msgReport=this.$view.find(this._CN+"order-ok-report-main"),this.$msgDemo=this.$view.find(this._CN+"order-ok-demo-message"),this.$msgNotFoundTgUsers=this.$view.find(this._CN+"order-ok-notg-message"),this.$msgManager=this.$view.find(this._CN+"order-ok-operator-message"),this.$msgOrderSentOther=this.$view.find(this._CN+"order-ok-report-other"),this.$msgCartList=this.$view.find(this._CN+"order-ok-cart-list"),this.$totalCost=this.$view.find(this._CN+"order-ok-total-cost"),this.$tplOrderedItem=t("#mm2-templates "+this._CN+"ordered-item"),this.behavior(),this},behavior:function(){var t=[this.$btnBasket,this.$btnBack,this.$btnClose];this._behavior(t),this.$btnBack.on("touchend click",(function(){return e.UVIEWS.go_first(),!1}))},update:function(t,i){console.log("order, short_number",t,t.short_number),this.TABLE_MODE=!(!i||!i.table_number),this.IIKO_MODE=""!==e.CAFE.get().iiko_api_key,this.PICKUPSELF_MODE=!(!i||!i.pickupself_mode),t.demo_mode?(this.$msgDemo.show(),this.$msgManager.hide()):t.notg_mode?(this.$msgDemo.hide(),this.$msgNotFoundTgUsers.show(),this.$msgManager.hide()):(this.$msgDemo.hide(),this.$msgNotFoundTgUsers.hide(),this.$msgManager.show());var s=e.CAFE.get("cafe_phone");if(""!==s?this.$headerPhone.find(this._CN+"header-phone__text").html(s):this.$headerPhone.hide(),s){var n=s.replace(/[-() ]/g,"");this.$headerPhone.on("touchend click",(function(){return location.href="tel:"+n,!1}))}var o=e.CAFE.get("cafe_currency").symbol,a=function(t,i){var s=t.split(" "),n=s[0].split("-");s[1];var o=e.LNG.get("lng_all_months").split("-"),a=i?" "+n[2]:"";return n[0]+" "+o[parseInt(n[1],10)-1]+a+", "+s[1]},r=["<h2>"+e.LNG.get("lng_number_of_your_order")+"</h2>","<h3>"+t.short_number+"</h3>"].join("\n");if(this.$msgReport.html(r),!this.TABLE_MODE){console.log("ORDER-ORDER",t);var _=t.order_time_need==t.order_time_sent?e.LNG.get("lng_near_time"):a(t.order_time_need);let i="";if(this.IIKO_MODE){const e=t.order_user_iiko_address,s=e.u_entrance?`, подъезд ${e.u_entrance}`:"",n=e.u_floor?`, эт. ${e.u_floor}`:"",o=e.u_flat?`, кв. ${e.u_flat}`:"";i=`ул. ${e.u_street}, д. ${e.u_house}${o}${n}${s}.`}else i=t.order_user_address;let s=this.PICKUPSELF_MODE?"<span>Доставка: </span> Заберу сам.<br>":`<span>${e.LNG.get("lng_address")}</span> ${i}<br>`;var h=["<p>","<span>"+e.LNG.get("lng_time_from")+"</span> "+a(t.order_time_sent)+"<br>","<span>"+e.LNG.get("lng_time_to")+"</span> "+_+"<br>","<span>"+e.LNG.get("lng_amount")+"</span> "+t.order_total_price+" "+o+"<br>","<span>"+e.LNG.get("lng_tel")+"</span> "+t.order_user_phone+"<br>",s,"<br>"+t.order_user_comment,"</p>"].join("\n");this.$msgOrderSentOther.html(h),this.chefsmenu.end_loading()}this.build_ordered_list(t.order_items),e.CART.cart_clear(),e.VIEW_ORDERING.update({clear:!0})},build_ordered_list:function(i){const s=e.CAFE.get("cafe_currency").symbol,n=""!==e.CAFE.get().iiko_api_key,o={iiko_buildArrRows:e=>{const i=t("<ul></ul>");for(let s in e)if(e.hasOwnProperty(s)){let n=e[s];if(n){let e=t("<li></li>");e.append(o.iiko_buildRow(n)),i.append(e)}}return i},iiko_buildRow:t=>{let e=t.item_data.title,i=t.count,n=t.price;t.uniq_name;let o=t.chosen_modifiers,a=t.volume;t.sizeName&&(a=t.sizeName+" / "+a);let r="";if(o.length)for(let t in o){r+="+ "+o[t].name+"<br>"}let _=this.$tplOrderedItem.clone();return _.find(this._CN+"ordered-title__item").html(e),_.find(this._CN+"ordered-title__volume").html(a),_.find(this._CN+"ordered-title__modifiers").html(r),_.find(this._CN+"ordered-quantity").html(i+" x "+n+" "+s),_}};if(n){const t=o.iiko_buildArrRows(i);this.$msgCartList.html(t)}else{let e=t("<ul></ul>");for(let n=0;n<i.length;n++){const o=t("<li></li>"),a=this.$tplOrderedItem.clone(),r=i[n].count,_=i[n].price;a.find(this._CN+"ordered-title__item").html(`${n+1}.${i[n].title}`),a.find(this._CN+"ordered-title__volume").html("").hide(),a.find(this._CN+"ordered-title__modifiers").html("").hide(),a.find(this._CN+"ordered-quantity").html(r+" x "+_+" "+s),o.append(a),e.append(o)}this.$msgCartList.html(e)}const a="Итого: "+e.CART.get_total_price()+" "+s;this.$totalCost.html(a)}},N={init:function(t){return this._init(t),this.$btnBasket=this.$view.find(this._CN+"btn-basket"),this.$btnClose=this.$view.find(this._CN+"btn-close-menu"),this.$btnBack=this.$view.find(this._CN+"btn-back, "+this._CN+"std-header-btn-back, "+this._CN+"btn-close-items"),this.$msgCancelReport=this.$view.find(this._CN+"order-cancel-message"),this.behavior(),this},behavior:function(){var t=[this.$btnBasket,this.$btnBack,this.$btnClose];this._behavior(t),this.$btnBack.on("touchend click",(function(){return e.UVIEWS.set_current("the-ordering"),!1}))},update:function(t){this.$msgCancelReport.html(t),this.chefsmenu.end_loading()}},w={init:function(t){return this._init(t),this.$headerIcon=this.$view.find(this._CN+"std-header-icon"),this.$headerTitle=this.$view.find(this._CN+"std-header-title"),this.$btnBasket=this.$view.find(this._CN+"btn-basket"),this.$btnClose=this.$view.find(this._CN+"btn-close-menu"),this.$btnBack=this.$view.find(this._CN+"btn-back, "+this._CN+"std-header-btn-back, "+this._CN+"btn-close-items"),this.$item_title=this.$view.find(this._CN+"item-modifiers__item-title"),this.$item_price=this.$view.find(this._CN+"item-modifiers__item-price"),this.$item_volume=this.$view.find(this._CN+"item-modifiers__item-volume"),this.$modifiers_list=this.$view.find(this._CN+"item-modifiers__list-section"),this.$modifiers_btn_add=this.$view.find(this._CN+"footer-modifiers__count-buttons_plus"),this.$modifiers_btn_sub=this.$view.find(this._CN+"footer-modifiers__count-buttons_minus"),this.$modifiers_counter=this.$view.find(this._CN+"footer-modifiers__count-buttons_counter"),this.$modifiers_btn_cart=this.$view.find(this._CN+"footer-modifiers__basket"),this.STARTSCROLL=0,this.MODIF_SCROLLED=!1,this.MODIFIERS_SHOWING_NOW=!1,this.behavior(),this},update:function(i,s,n,o){this.ITEM_DATA=s.get(),this.MENU=i,this.SIZER=n,this.TOTAL_ADD_TO_CART=1,this.onAddToCart=o.onAddToCart,this.MODIFIERS=t.extend({},l),this.MODIFIERS.init(this.ITEM_DATA),this.insert_data(),this.update_header(i),this.recalc_sum(),this.$item_title.html(item.title);const a=n.get();let r=a.price,_=a.volume;const h=e.CAFE.get("cafe_currency").symbol;this.$item_price.html(r+" "+h),this.$item_volume.html(_)},update_header:function(t){for(var i in this.$headerTitle.find("span").html(t.title),e.MENU_ICONS.get())this.$headerIcon.removeClass(this.CN+"icon-"+e.MENU_ICONS.get(i));this.$headerIcon.addClass(this.CN+"icon-"+e.MENU_ICONS.get(t.id_icon))},behavior:function(){const t=[this.$btnBack,this.$btnClose,this.$modifiers_btn_add,this.$modifiers_btn_sub,this.$modifiers_btn_cart];this._behavior(t),this.$btnBack.on("touchend click",(t=>(this.hide(),!1))),this.$modifiers_btn_add.on("touchend click",(t=>{this.TOTAL_ADD_TO_CART++,this.recalc_sum(),t.originalEvent.cancelable&&t.preventDefault()})),this.$modifiers_btn_sub.on("touchend click",(t=>{this.TOTAL_ADD_TO_CART--,this.recalc_sum(),t.originalEvent.cancelable&&t.preventDefault()})),this.$modifiers_list.on("touchstart",(t=>{this.MODIF_SCROLLED=!1})),this.$modifiers_list.on("touchmove",(t=>{this.MODIF_SCROLLED=!0})),this.$modifiers_btn_cart.on("touchend click",(t=>{this.add_order_to_cart(),t.originalEvent.cancelable&&t.preventDefault()}))},add_order_to_cart:function(){let t=e.CART.add_order(this.ITEM_DATA,this.PRE_ORDER);this.onAddToCart&&this.onAddToCart(t),this.hide()},update_ui:function(t,e){const i="<div>В корзину</div><div> "+e+" руб.</div>";this.$modifiers_counter.find("span").html(""+t),this.$modifiers_btn_cart.find("span").html(i)},hide:function(){e.UVIEWS.go_back()}},I={init:function(t){return this._init(t),this.$btnBasket=this.$view.find(this._CN+"btn-basket"),this.$btnClose=this.$view.find(this._CN+"btn-close-menu"),this.$btnBack=this.$view.find(this._CN+"btn-back, "+this._CN+"std-header-btn-back, "+this._CN+"btn-close-items"),this.$btnSave=this.$view.find(this._CN+"btn-save"),this.$table_list=this.$view.find(this._CN+"alltables-list"),this.behavior(),this},update:function(t){this._need2save(!1),this.CURRENT_TABLE=parseInt(t,10),this.CHOSEN_TABLE=-1;let i=e.CAFE.get().tables_uniq_names;i=JSON.parse(i);let s=e.CAFE.get().iiko_tables;if(s=JSON.parse(s),!s||!i)return!1;this.build(s,i,t)},build:function(e,i,s){let n="";for(let t in e)if(e.hasOwnProperty(t)){let o=e[t],a=o.tables;if(a.length)for(let t in a)if(a.hasOwnProperty(t)){let e=a[t];n+=`<li class="${parseInt(e.number,10)===parseInt(s,10)?"current":""} ${i["table-"+e.number]?"":"disabled"}" data-table-number="${e.number}">\n\t\t\t\t\t\t\t\t<span>№-${e.number}<span>\n\t\t\t\t\t\t\t\t<span>${o.section_name}: ${e.name}</span>\n\t\t\t\t\t\t\t\t</li>`}}n=`<ul>${n}</ul>`,this.$table_list.html(n),this.$table_list.find("li").each(((e,i)=>{t(i).on("touchstart",(e=>{t(i).addClass("active")})),t(i).on("touchend",(e=>{t(i).removeClass("active"),this.VIEW_SCROLLED||t(i).hasClass("current")||t(i).hasClass("disabled")||(t(i).siblings().removeClass("current"),t(i).addClass("current"),this.check_if_need2save(t(i).data("table-number"))),e.originalEvent.cancelable&&e.preventDefault()}))}))},check_if_need2save:function(t){this.CHOSEN_TABLE=parseInt(t,10);let e=this.CHOSEN_TABLE!==this.CURRENT_TABLE;this._need2save(e)},behavior:function(){const t=[this.$btnBasket,this.$btnBack,this.$btnClose];this._behavior(t),this.$btnBack.on("touchend click",(t=>{e.UVIEWS.go_first(),t.originalEvent.cancelable&&t.preventDefault()})),this.$btnSave.on("touchend click",(t=>{this.save(),t.originalEvent.cancelable&&t.preventDefault()}))},save:function(){if(console.log("new save",this.CHOSEN_TABLE),this.CHOSEN_TABLE<1)return!1;let t=e.CAFE.get().tables_uniq_names;if(!t)return!1;t=JSON.parse(t);let i=t["table-"+this.CHOSEN_TABLE];if(!i)return!1;const s=e.CAFE.get("uniq_name"),n=`${SITE_CFG.home_page}cafe/${s}/table/${i}`;location.href=n}};e.META_VIEWPORT=i,e.CALLBACK_RANDOM=s,e.MOBILE_BUTTONS=n,e.UVIEWS=o,e.CAFE={init:function(t){this.OBJ_CAFE=t},get:function(t){return t?"cafe_currency"===t?this.get_currency():this.OBJ_CAFE[t]:this.OBJ_CAFE},get_status:function(){return this.OBJ_CAFE.cafe_status},get_currency:function(){var t=this.OBJ_CAFE.cafe_currency,e={RUB:"руб.",USD:"$",EUR:"€",JPY:"¥",GBP:"£",KRW:"₩"}[t.toUpperCase()];return e?{code:t,symbol:e}:{code:"USD",symbol:"$"}}},e.LNG=a,e.MENU_ICONS={init:function(){this.arrIcons=["main_dishes","soups","salade","chicken","fish","steak","seafood","bbq","kebabs","pasta","pizza","sushi_and_rolls","dumpling","asian_food","sandwiches","slicing","canapes","fast_food","ice_cream","fruits","pancakes","bakery","cakes","childrens_menu","tea","coffee","juice_and_water","cocktails","beer","alcohol"]},get:function(t){return t?this.arrIcons[t]?this.arrIcons[t]:"":this.arrIcons}},e.CART=r,e.ITEM=c,e.CHEFSMENU=d,e.TABINDEX=u,e.MENU_TABLE_MODE=m,e.VIEW_ALLMENU=t.extend(p,f),e.VIEW_ALLITEMS=t.extend(g,f),e.VIEW_CART=t.extend(v,f),e.VIEW_ORDERING=t.extend(A,f),e.VIEW_CHOOSING_MODE=t.extend(b,f),e.VIEW_THANK_YOU=t.extend(E,f),e.VIEW_ORDER_OK=t.extend(S,f),e.VIEW_ORDER_CANCEL=t.extend(N,f),e.VIEW_IIKO_MODIFIERS=t.extend(w,f),e.VIEW_TABLE_CHANGE=t.extend(I,f),e.G_DATA="CHEFSMENUGLOBALDATA";var T=function(t){e.META_VIEWPORT.init();var i=e.META_VIEWPORT.is_mobile(),s=t(".chefsmenu-link");if(s.length){window[e.G_DATA]||(window[e.G_DATA]={WAS_BUILT:!1,PRE:"mm2-",SHOWED:0,ALLCAFE:{},ALLMENU:{},ALLITEMS:{},ALLSKINS:null,MAINSTYLE:"",CURRSKIN:{id:null,link:null},EXT_MODE:i});var n={prepare_menu:function(i,s){t.extend({},d).init({G_DATA:e.G_DATA,$link:i,CHEFS_URL:CHEFS_URL,onReady:s})}};n.prepare_menu(s.eq(0),(function(){s.length>1&&s.each((function(e){e&&n.prepare_menu(t(this),!1)}))}))}}(jQuery);return T}(jQuery);
